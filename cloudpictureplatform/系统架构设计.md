# 网上云展览系统 - 架构设计文档

## 一、系统概述

### 1.1 系统目标
创建一个基于HTML的网上云展览平台，允许用户上传手机相簿照片，并实时进行线上展览展示，模拟实体展览馆的体验。

### 1.2 核心功能模块（两大核心）

#### 模块一：上传照片
- 支持手机相簿直接上传
- 多文件批量上传
- 实时预览和确认
- 自动处理和存储

#### 模块二：观看云展览
- 实时展览展示
- 展览馆式浏览体验
- 多种展览模式
- 沉浸式观看体验

---

## 二、系统架构

### 2.1 整体架构层次（两大核心模块）

```
┌─────────────────────────────────────────────────────────┐
│                   用户界面层 (UI Layer)                    │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌────────────────────┐      ┌────────────────────┐     │
│  │   模块一：上传照片   │      │  模块二：观看云展览  │     │
│  │   upload.html      │      │   gallery.html     │     │
│  │                    │      │                    │     │
│  │  - 文件选择器       │      │  - 展览馆布局       │     │
│  │  - 预览区域         │      │  - 照片展示墙       │     │
│  │  - 上传按钮         │      │  - 全屏浏览         │     │
│  │  - 进度显示         │      │  - 导航控制         │     │
│  └────────────────────┘      └────────────────────┘     │
│                                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │            index.html (主页导航入口)               │   │
│  │        选择进入"上传照片" 或 "观看展览"             │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│                 业务逻辑层 (Business Layer)                │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌────────────────────┐      ┌────────────────────┐     │
│  │   上传处理模块       │      │   展览展示模块       │     │
│  │   upload.js         │      │   gallery.js       │     │
│  │                    │      │                    │     │
│  │  - 文件验证         │      │  - 数据读取         │     │
│  │  - 图片处理         │      │  - 布局渲染         │     │
│  │  - 存储管理         │      │  - 交互控制         │     │
│  └─────────┬──────────┘      └─────────┬──────────┘     │
│            │                            │                 │
│            └────────────┬───────────────┘                 │
│                         │                                 │
│            ┌────────────▼──────────────┐                 │
│            │    image-processor.js      │                 │
│            │    storage.js              │                 │
│            │    utils.js                │                 │
│            └────────────────────────────┘                 │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│                 数据存储层 (Storage Layer)                │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌──────────────────────────────────────────────┐     │
│  │            IndexedDB                          │     │
│  │  统一数据存储（适用于GitHub Pages）            │     │
│  │                                                │     │
│  │  ├── photos (对象存储)                         │     │
│  │  │   └── 照片文件 (Blob数据)                   │     │
│  │  │                                              │     │
│  │  ├── metadata (对象存储)                       │     │
│  │  │   └── 照片元数据 (JSON对象)                  │     │
│  │  │                                              │     │
│  │  └── settings (对象存储)                       │     │
│  │      └── 系统设置 (JSON对象)                    │     │
│  └──────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────┘
```

### 2.2 技术栈选择

#### 前端技术
- **HTML5** - 基础结构
- **CSS3** - 样式和动画效果
- **JavaScript (ES6+)** - 交互逻辑
- **File API** - 文件上传处理
- **Canvas API** - 图片预览和处理
- **IndexedDB** - 数据存储（照片文件和元数据，适用于GitHub Pages）
- **Web Workers** - 图片处理优化

#### 3D核心技术（核心功能）
- **WebGL** - 3D图形渲染
- **Three.js** - 3D展览馆核心框架
- **OrbitControls** - 3D场景相机控制
- **GLTFLoader/TextureLoader** - 3D模型和纹理加载

#### 可选技术增强
- **PWA技术** - 离线支持和移动端优化
- **Service Worker** - 缓存管理

---

## 三、核心功能模块详细设计

### 3.1 模块一：照片上传模块

#### 功能点
- **多文件选择**：支持一次选择多张照片
- **数量限制**：最多上传20张照片（系统限制）
- **拖拽上传**：支持拖拽文件到上传区域
- **手机相簿访问**：通过 `<input type="file" accept="image/*" multiple>` 访问
- **实时预览**：上传前预览照片
- **上传进度**：显示上传进度条
- **格式验证**：检查文件格式和大小
- **数量验证**：检查照片数量是否超过限制
- **图片压缩**：自动压缩大图片以优化性能

#### 界面元素
- 上传按钮/区域
- 文件选择器
- 预览网格
- 进度指示器
- 数量提示（显示已选择/最多20张）
- 错误提示（超过限制时的提示）

#### 限制说明
- **最大照片数量**：20张
- **单次上传限制**：如果已有照片，新上传的照片总数不能超过20张
- **提示信息**：当达到或接近限制时，显示相应提示

### 3.2 模块二：观看云展览模块（含3D核心功能）

#### 功能点
- **3D虚拟展览馆**：核心功能，使用WebGL/Three.js创建3D空间
- **传统画廊模式**：网格或瀑布流布局（备选模式）
- **全屏浏览**：点击照片进入全屏模式
- **3D场景交互**：用户在虚拟空间中"走动"和浏览
- **照片挂墙展示**：照片以3D方式挂在虚拟墙上
- **导航控制**：3D场景相机控制 + 传统导航
- **响应式设计**：适配不同屏幕尺寸

#### 展览馆模式选项

- **模式1：3D虚拟展览馆（核心模式）** ⭐⭐⭐
  - 使用Three.js创建3D展览空间
  - 虚拟展览馆场景（房间、走廊、展厅等）
  - 照片以3D相框形式挂在虚拟墙上
  - 用户可以通过鼠标/触摸控制相机"走动"
  - 支持第一人称视角浏览
  - 点击照片可放大查看详情
  - 支持多个展厅/房间切换
  - 3D场景光照和阴影效果

- **模式2：传统画廊模式（备选模式）**
  - 单列或双列布局
  - 照片按顺序排列
  - 支持分类标签
  - 适合低性能设备

- **模式3：时间轴模式（可选）**
  - 按上传时间或拍摄时间排序
  - 时间轴可视化

### 3.3 展览配置功能（集成在展览模块中）

#### 功能点
- **展览主题设置**：选择展览风格和主题（在展览页面内设置）
- **布局模式切换**：在展览页面内切换不同布局方式
- **播放设置**：设置自动播放速度等（在展览页面内设置）
- **照片管理**：在展览页面内可删除照片（简化管理功能）

---

## 四、文件结构规划（两大核心模块）

```
cloudpictureplatform/
│
├── index.html                 # 主页入口（选择上传或观看）
│
├── upload.html                # 【模块一】上传照片页面
│
├── gallery.html               # 【模块二】观看云展览页面
│
├── css/
│   ├── main.css               # 主样式文件（通用样式）
│   ├── index.css              # 主页样式
│   ├── upload.css             # 上传页面样式
│   ├── gallery.css            # 展览页面样式
│   └── themes/                # 展览主题样式
│       ├── classic.css        # 经典主题
│       ├── modern.css         # 现代主题
│       └── dark.css           # 暗色主题
│
├── js/
│   ├── main.js                # 主逻辑文件（导航等）
│   │
│   ├── upload.js              # 【模块一】上传功能核心
│   │   ├── 文件选择处理
│   │   ├── 预览功能
│   │   ├── 上传处理
│   │   └── 存储保存
│   │
│   ├── gallery.js             # 【模块二】展览功能核心
│   │   ├── 数据读取
│   │   ├── 模式切换（3D/传统）
│   │   ├── 传统布局渲染
│   │   └── 交互控制
│   │
│   ├── 3d-gallery.js          # 【核心】3D展览馆功能
│   │   ├── Three.js场景初始化
│   │   ├── 3D场景构建（房间、墙面）
│   │   ├── 照片3D相框创建
│   │   ├── 相机控制（OrbitControls）
│   │   ├── 交互处理（点击、移动）
│   │   └── 场景渲染循环
│   │
│   ├── storage.js              # 存储管理（两个模块共用）
│   ├── image-processor.js     # 图片处理（两个模块共用）
│   ├── utils.js               # 工具函数（两个模块共用）
│   │
│   └── libs/                   # 第三方库
│       ├── three.min.js       # Three.js核心库
│       ├── OrbitControls.js   # 相机控制器
│       └── GLTFLoader.js      # 3D模型加载器（可选）
│
├── assets/
│   ├── images/                # 系统图片资源
│   ├── icons/                 # 图标
│   ├── fonts/                 # 字体文件
│   └── models/                # 3D模型资源（可选）
│       └── (3D展览馆模型文件)
│
└── README.md                  # 项目说明文档
```

### 4.1 页面结构说明

#### 主页 (index.html)
- 系统入口
- 两个大按钮：**"上传照片"** 和 **"观看展览"**
- 简洁的导航设计

#### 上传页面 (upload.html)
- **模块一的核心页面**
- 专注于照片上传功能
- 上传完成后可跳转到展览页面

#### 展览页面 (gallery.html)
- **模块二的核心页面**
- 专注于展览展示功能
- 可在此页面内进行简单的照片管理（删除等）

---

## 五、数据模型设计

### 5.1 照片对象 (Photo)
```javascript
{
  id: "唯一标识符",
  filename: "文件名",
  originalName: "原始文件名",
  uploadTime: "上传时间戳",
  fileSize: "文件大小（字节）",
  width: "图片宽度",
  height: "图片高度",
  thumbnail: "缩略图URL或Base64",
  fullImage: "完整图片URL或Base64",
  category: "分类",
  tags: ["标签1", "标签2"],
  description: "描述",
  metadata: {
    // EXIF数据（如果提取）
  }
}
```

### 5.3 系统限制配置
```javascript
{
  maxPhotos: 20,           // 最多照片数量限制
  maxFileSize: 10 * 1024 * 1024,  // 单张照片最大10MB（示例）
  allowedFormats: ['image/jpeg', 'image/png', 'image/webp'],  // 允许的格式
  maxTotalSize: 200 * 1024 * 1024  // 总存储大小限制（可选）
}
```

### 5.2 展览对象 (Exhibition)
```javascript
{
  id: "展览ID",
  title: "展览标题",
  description: "展览描述",
  createdTime: "创建时间",
  lastModified: "最后修改时间",
  theme: "主题样式",
  layout: "布局模式",
  photos: ["照片ID1", "照片ID2", ...],
  settings: {
    autoPlay: false,
    playInterval: 3000,
    showInfo: true,
    // 其他设置
  }
}
```

---

## 六、用户交互流程（两大核心流程）

### 6.1 流程一：上传照片流程
```
用户打开主页 (index.html)
    ↓
点击"上传照片"按钮
    ↓
进入上传页面 (upload.html)
    ↓
选择照片（从手机相簿或电脑）
    ↓
系统验证：
    - 检查文件格式
    - 检查文件大小
    - 检查数量限制（最多20张）
    ↓
如果超过20张：
    - 提示"最多只能上传20张照片"
    - 显示当前已选择数量
    - 要求用户减少照片数量
    ↓
实时预览照片（显示已选择X/20张）
    ↓
确认上传
    ↓
系统处理（压缩、生成缩略图）
    ↓
检查IndexedDB存储：
    - 读取已有照片数量
    - 如果已有照片+新照片超过20张
    - 提示删除旧照片或减少新照片
    ↓
保存到IndexedDB：
    - 照片文件存储到photos对象存储
    - 元数据存储到metadata对象存储
    - 更新settings中的照片计数
    ↓
显示上传成功（显示总照片数/20）
    ↓
提示"立即观看展览"或返回主页
```

### 6.2 流程二：观看云展览流程（3D核心模式）
```
用户打开主页 (index.html)
    ↓
点击"观看展览"按钮
    ↓
进入展览页面 (gallery.html)
    ↓
从IndexedDB加载所有照片数据：
    - 从photos对象存储读取照片文件
    - 从metadata对象存储读取元数据
    ↓
初始化3D展览馆场景（Three.js）
    ↓
构建3D虚拟展览空间
    - 创建展览馆房间/走廊
    - 创建虚拟墙面
    - 将照片以3D相框形式挂在墙上
    ↓
用户进入3D展览馆
    ↓
通过鼠标/触摸控制相机"走动"
    - 鼠标拖拽：旋转视角
    - 滚轮：缩放
    - WASD/方向键：移动（可选）
    ↓
浏览3D场景中的照片
    ↓
点击照片进入详情/全屏模式
    ↓
可在展览页面内切换模式（3D/传统）
```

### 6.3 完整使用流程
```
新用户首次使用：
主页 → 上传照片 → 上传完成 → 观看展览

已有照片的用户：
主页 → 观看展览（直接浏览）

上传新照片后：
上传页面 → 上传完成 → 跳转到展览页面（自动刷新）
```

---

## 七、3D展览馆详细设计

### 7.1 3D场景架构

#### 场景组成
```
3D展览馆场景
├── 场景环境
│   ├── 地面（Plane Geometry）
│   ├── 天花板（可选）
│   └── 环境光照（Ambient Light + Directional Light）
│
├── 展览空间
│   ├── 主展厅（大房间）
│   ├── 侧展厅（小房间，可选）
│   └── 走廊连接（可选）
│
├── 墙面系统
│   ├── 前墙（Front Wall）
│   ├── 左墙（Left Wall）
│   ├── 右墙（Right Wall）
│   └── 后墙（Back Wall）
│
└── 照片展示
    ├── 3D相框（Frame Mesh）
    ├── 照片纹理（Texture）
    └── 交互区域（Raycasting）
```

### 7.2 3D技术实现

#### Three.js核心组件
- **Scene（场景）**：3D场景容器
- **Camera（相机）**：PerspectiveCamera（透视相机）
- **Renderer（渲染器）**：WebGLRenderer
- **Controls（控制器）**：OrbitControls（轨道控制）
- **Lighting（光照）**：
  - AmbientLight（环境光）
  - DirectionalLight（方向光）
  - PointLight（点光源，可选）

#### 3D对象创建
- **墙面（Wall）**：使用PlaneGeometry创建平面
- **相框（Frame）**：使用BoxGeometry创建3D相框
- **照片（Photo）**：使用PlaneGeometry + Texture加载照片
- **地面（Floor）**：使用PlaneGeometry创建地面

### 7.3 照片挂墙算法

#### 布局策略
1. **均匀分布**：照片在墙面上均匀分布
2. **网格布局**：按网格排列照片
3. **自适应间距**：根据照片数量自动调整间距
4. **多墙分配**：照片数量多时分配到多个墙面

#### 实现步骤
```
1. 计算每面墙可容纳的照片数量
2. 根据照片总数分配照片到各墙面
3. 计算每张照片在墙面上的位置（x, y坐标）
4. 创建3D相框对象
5. 加载照片纹理并应用到相框
6. 将相框添加到场景中
```

### 7.4 交互控制

#### 相机控制（OrbitControls）
- **鼠标左键拖拽**：旋转视角
- **鼠标滚轮**：缩放（拉近/拉远）
- **鼠标右键拖拽**：平移视角（可选）
- **触摸手势**：移动端支持触摸控制

#### 照片交互
- **鼠标悬停**：高亮显示相框
- **点击照片**：进入全屏/详情模式
- **射线检测（Raycasting）**：检测点击的3D对象

#### 导航功能
- **自动漫游**：自动移动相机浏览（可选）
- **预设视角**：快速切换到特定视角
- **缩略图导航**：显示缩略图，点击跳转

### 7.5 性能优化

#### 渲染优化
- **LOD（细节层次）**：远距离照片使用低分辨率
- **视锥剔除**：只渲染可见区域的照片
- **纹理压缩**：使用压缩纹理格式
- **实例化渲染**：相同相框使用InstancedMesh

#### 加载优化
- **渐进式加载**：先加载场景，再加载照片
- **按需加载**：只加载可见区域的照片
- **纹理缓存**：缓存已加载的纹理

### 7.6 移动端适配

#### 性能考虑
- **简化场景**：移动端使用简化版3D场景
- **降低质量**：降低渲染质量和分辨率
- **触摸优化**：优化触摸控制体验

#### 兼容性
- **WebGL检测**：检测浏览器WebGL支持
- **降级方案**：不支持WebGL时自动切换到传统模式

---

## 八、存储方案（GitHub Pages兼容）

### 8.1 存储方案（纯IndexedDB）

#### 为什么使用IndexedDB
- **GitHub Pages兼容**：GitHub Pages是静态网站托管，只支持纯前端技术
- **LocalStorage限制**：LocalStorage容量小（通常5-10MB），不适合存储大量图片数据
- **IndexedDB优势**：
  - 容量大（通常几百MB到几GB）
  - 支持存储Blob数据（照片文件）
  - 支持结构化数据（元数据）
  - 异步操作，性能好

#### 存储结构设计
```javascript
// IndexedDB数据库结构
数据库名称: CloudPicturePlatform
版本: 1

对象存储1: photos
  - key: photoId (自增ID)
  - value: {
      id: "照片ID",
      file: Blob,           // 照片文件数据
      thumbnail: Blob,      // 缩略图数据
      uploadTime: timestamp,
      fileSize: number,
      width: number,
      height: number
    }

对象存储2: metadata
  - key: photoId
  - value: {
      id: "照片ID",
      filename: "文件名",
      originalName: "原始文件名",
      uploadTime: "上传时间戳",
      fileSize: "文件大小",
      width: "图片宽度",
      height: "图片高度",
      category: "分类",
      tags: ["标签1", "标签2"],
      description: "描述"
    }

对象存储3: settings
  - key: "system"
  - value: {
      maxPhotos: 20,
      currentCount: 15,
      theme: "classic",
      layout: "3d"
    }
```

#### 实现要点
- **统一存储接口**：所有数据（照片、元数据、设置）都存储在IndexedDB
- **事务管理**：使用事务确保数据一致性
- **异步操作**：所有存储操作都是异步的
- **错误处理**：完善的错误处理和降级方案

### 8.2 GitHub Pages部署注意事项

#### 静态文件限制
- **文件大小**：GitHub Pages对单个文件有大小限制（通常100MB）
- **存储位置**：所有数据存储在用户浏览器中，不占用GitHub存储空间
- **跨域问题**：IndexedDB是浏览器本地API，无跨域限制

#### 数据持久化
- **浏览器本地**：数据存储在用户浏览器中
- **清除数据**：用户清除浏览器数据会丢失照片
- **隐私保护**：数据不会上传到服务器，保护用户隐私

### 8.3 未来扩展方案（如需云端同步）

如果需要云端存储，可以考虑：
- **GitHub Gist API**：使用GitHub Gist存储元数据（需要用户授权）
- **GitHub Pages + GitHub Actions**：通过GitHub Actions处理数据
- **第三方云存储**：集成云存储服务（需要API密钥）
- **后端服务**：部署独立的后端服务（如Vercel、Netlify Functions）

---

## 九、性能优化考虑

### 8.1 图片优化
- **懒加载**：只加载可见区域的图片
- **缩略图**：生成小尺寸缩略图用于列表展示
- **渐进式加载**：先显示模糊版本，再加载清晰版本
- **WebP格式**：使用现代图片格式减少文件大小

### 8.2 渲染优化
- **虚拟滚动**：大量照片时使用虚拟滚动
- **防抖节流**：优化滚动和窗口调整事件
- **Web Workers**：图片处理在后台线程进行

### 8.3 缓存策略
- **Service Worker**：缓存静态资源和已加载的图片
- **LocalStorage缓存**：缓存元数据减少读取时间

---

## 十、响应式设计

### 9.1 断点设计
- **移动端**：< 768px
- **平板**：768px - 1024px
- **桌面**：> 1024px

### 9.2 移动端优化
- **触摸手势**：支持滑动切换照片
- **简化界面**：移动端隐藏非必要元素
- **性能优先**：移动端使用更轻量的布局模式

---

## 十一、安全考虑

### 10.1 文件验证
- **文件类型检查**：只允许图片格式（JPEG, PNG, WebP等）
- **文件大小限制**：防止过大文件（单张照片建议最大10MB）
- **数量限制**：最多上传20张照片
- **文件名清理**：防止路径遍历攻击
- **存储空间检查**：确保总照片数不超过20张

### 10.2 数据安全
- **输入验证**：验证所有用户输入
- **XSS防护**：转义用户输入内容

---

## 十二、开发阶段规划

### 阶段1：基础架构
- 创建项目文件结构
- 实现基础HTML页面
- 设置CSS框架

### 阶段2：核心功能
- 实现照片上传功能
- 实现基础存储功能
- 实现简单展览展示

### 阶段3：增强功能
- 实现照片管理
- 实现多种展览模式
- 优化用户体验

### 阶段4：高级功能
- 3D展览馆（可选）
- PWA支持（可选）
- 性能优化

---

## 十三、未来扩展方向

1. **用户系统**：多用户支持，账户管理
2. **云端同步**：数据云端备份和同步
3. **社交功能**：分享展览，评论功能
4. **AI功能**：自动分类，智能推荐
5. **VR支持**：VR设备浏览展览
6. **多语言支持**：国际化

---

## 总结

本系统采用纯前端HTML/CSS/JavaScript技术栈，初期使用浏览器本地存储，实现一个功能完整的云展览平台。系统设计注重用户体验，模拟实体展览馆的浏览感受，同时充分利用现代Web技术提供流畅的交互体验。

架构设计完成后，可以按照模块逐步实现各个功能，确保系统的可维护性和可扩展性。

