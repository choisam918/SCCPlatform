# 网上云展览系统 - 架构图

## 系统核心架构图（两大模块）

```
┌─────────────────────────────────────────────────────────────────┐
│                        主页入口层                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│                    ┌──────────────────┐                          │
│                    │   index.html     │                          │
│                    │   主页导航       │                          │
│                    └────────┬─────────┘                          │
│                             │                                    │
│                ┌────────────┴────────────┐                      │
│                │                         │                      │
└────────────────┼─────────────────────────┼──────────────────────┘
                 │                         │
                 ▼                         ▼
┌────────────────────────┐    ┌────────────────────────┐
│   模块一：上传照片       │    │   模块二：观看云展览     │
├────────────────────────┤    ├────────────────────────┤
│                        │    │                        │
│  upload.html           │    │  gallery.html          │
│  上传页面               │    │  展览页面               │
│                        │    │                        │
│  - 文件选择器           │    │  - 展览馆布局           │
│  - 预览区域             │    │  - 照片展示墙           │
│  - 上传按钮             │    │  - 全屏浏览             │
│  - 进度显示             │    │  - 导航控制             │
│                        │    │  - 模式切换             │
└───────────┬────────────┘    └───────────┬────────────┘
            │                              │
            └──────────────┬───────────────┘
                           │
┌──────────────────────────▼──────────────────────────┐
│              业务逻辑层 (JavaScript)                   │
├──────────────────────────────────────────────────────┤
│                                                       │
│  ┌──────────────┐          ┌──────────────┐         │
│  │  upload.js   │          │  gallery.js  │         │
│  │  上传处理     │          │  展览控制     │         │
│  └──────┬───────┘          └──────┬───────┘         │
│         │                         │                  │
│         │                         ▼                  │
│         │                  ┌──────────────┐         │
│         │                  │ 3d-gallery.js│         │
│         │                  │ 3D展览核心    │         │
│         │                  │              │         │
│         │                  │ - Three.js   │         │
│         │                  │ - 场景构建    │         │
│         │                  │ - 相机控制    │         │
│         │                  │ - 交互处理    │         │
│         │                  └──────┬───────┘         │
│         │                         │                  │
│         └──────────┬───────────────┘                  │
│                    │                                   │
│  ┌─────────────────▼─────────────────┐                │
│  │    image-processor.js              │                │
│  │    图片处理（压缩、缩略图）          │                │
│  └─────────────────┬─────────────────┘                │
│                    │                                   │
│  ┌─────────────────▼─────────────────┐                │
│  │         storage.js                │                │
│  │    存储管理（统一接口）             │                │
│  └─────────────────┬─────────────────┘                │
│                    │                                   │
│  ┌─────────────────▼─────────────────┐                │
│  │          utils.js                 │                │
│  │      工具函数（共用）               │                │
│  └───────────────────────────────────┘                │
└───────────────────────────┬───────────────────────────┘
                            │
┌───────────────────────────▼───────────────────────────┐
│                    数据存储层                            │
├───────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────────────────────────────────────┐      │
│  │            IndexedDB                          │      │
│  │  统一数据存储（GitHub Pages兼容）              │      │
│  │                                                │      │
│  │  ├── photos (对象存储)                        │      │
│  │  │   └── 照片文件 (Blob数据)                   │      │
│  │  │                                              │      │
│  │  ├── metadata (对象存储)                       │      │
│  │  │   └── 照片元数据 (JSON对象)                  │      │
│  │  │                                              │      │
│  │  └── settings (对象存储)                       │      │
│  │      └── 系统设置 (JSON对象)                    │      │
│  └──────────────────────────────────────────────┘      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 数据流向图（两大核心流程）

```
┌─────────────────────────────────────────────────────────┐
│                   流程一：上传照片                        │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  用户进入 upload.html                                     │
│      │                                                    │
│      ▼                                                    │
│  ┌─────────┐                                             │
│  │ 选择照片 │ (从手机相簿或电脑)                            │
│  └────┬────┘                                             │
│       │                                                   │
│       ▼                                                   │
│  ┌─────────┐      ┌──────────┐      ┌──────────┐       │
│  │ 文件验证 │ ───▶│ 图片处理 │ ───▶│ 生成缩略图│       │
│  └─────────┘      └──────────┘      └────┬─────┘       │
│                                           │              │
│                                           ▼              │
│                                   ┌──────────────┐       │
│                                   │ 保存到存储层 │       │
│                                   │ (IndexedDB + │       │
│                                   │  LocalStorage)│       │
│                                   └──────────────┘       │
│                                           │              │
│                                           ▼              │
│                                   上传成功，可跳转展览     │
│                                                           │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│           流程二：观看云展览（3D核心模式）                  │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  用户进入 gallery.html                                    │
│      │                                                    │
│      ▼                                                    │
│  ┌─────────┐                                             │
│  │ 读取数据 │ (从 IndexedDB + LocalStorage)               │
│  └────┬────┘                                             │
│       │                                                   │
│       ▼                                                   │
│  ┌─────────┐      ┌──────────┐      ┌──────────┐       │
│  │ 解析数据 │ ───▶│ 初始化3D  │ ───▶│ 构建3D   │       │
│  │(元数据) │      │ 场景     │      │ 展览馆    │       │
│  │         │      │(Three.js)│      │(墙面+地面)│       │
│  └─────────┘      └────┬─────┘      └────┬─────┘       │
│                        │                  │             │
│                        ▼                  ▼             │
│                  ┌──────────┐      ┌──────────┐       │
│                  │ 创建相框  │ ───▶│ 照片挂墙 │       │
│                  │(Geometry)│      │(纹理加载)│       │
│                  └────┬─────┘      └────┬─────┘       │
│                       │                 │             │
│                       ▼                 ▼             │
│              ┌──────────────────────────────┐          │
│              │  WebGL渲染 + 交互控制        │          │
│              │  - OrbitControls相机控制     │          │
│              │  - 射线检测点击交互          │          │
│              │  - 实时渲染循环              │          │
│              └──────────────────────────────┘          │
│                                                           │
│  用户可在3D场景中自由"走动"浏览照片                        │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

## 功能模块依赖关系（两大核心模块）

```
main.js (主入口 - 主页导航)
    │
    ├──► utils.js (工具函数 - 共用)
    │
    ├──► storage.js (存储管理 - 共用)
    │       │
    │       └──► IndexedDB API
    │           ├── photos对象存储
    │           ├── metadata对象存储
    │           └── settings对象存储
    │
    ├──► image-processor.js (图片处理 - 共用)
    │       │
    │       ├──► File API
    │       └──► Canvas API
    │
    ├──► upload.js (模块一：上传功能)
    │       │
    │       ├──► image-processor.js
    │       ├──► storage.js
    │       └──► utils.js
    │
    └──► gallery.js (模块二：展览功能)
            │
            ├──► storage.js
            ├──► utils.js
            └──► 3d-gallery.js (核心：3D展览馆)
                    │
                    ├──► Three.js (WebGL核心库)
                    ├──► OrbitControls (相机控制)
                    ├──► TextureLoader (纹理加载)
                    └──► WebGL API
```

## 页面路由结构（两大核心模块）

```
                    index.html
                    (主页入口)
                         │
            ┌────────────┴────────────┐
            │                         │
            ▼                         ▼
    ┌──────────────┐          ┌──────────────┐
    │ 模块一：上传   │          │ 模块二：观看   │
    │  upload.html │          │ gallery.html │
    └──────────────┘          └──────┬───────┘
            │                        │
            │                        │
            │  上传完成后可跳转        │
            └──────────►─────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
            ┌──────────────┐              ┌──────────────┐
            │ 传统画廊模式   │              │ 3D展览馆模式  │
            │ 网格布局       │              │ (可选)       │
            └──────────────┘              └──────────────┘
```

## 存储数据结构（IndexedDB统一存储）

```
IndexedDB数据库: CloudPicturePlatform

├── photos (对象存储)
│   └── 照片ID → {
│       id: "照片ID",
│       file: Blob,        // 照片文件
│       thumbnail: Blob,   // 缩略图
│       uploadTime: timestamp,
│       fileSize: number,
│       width: number,
│       height: number
│   }
│
├── metadata (对象存储)
│   └── 照片ID → {
│       id: "照片ID",
│       filename: "文件名",
│       originalName: "原始文件名",
│       uploadTime: "上传时间戳",
│       fileSize: "文件大小",
│       width: "图片宽度",
│       height: "图片高度",
│       category: "分类",
│       tags: ["标签1", "标签2"],
│       description: "描述"
│   }
│
└── settings (对象存储)
    └── "system" → {
        maxPhotos: 20,
        currentCount: 15,
        theme: "classic",
        layout: "3d"
    }
```

## 响应式布局断点

```
移动端 (< 768px)
    │
    ├── 单列布局
    ├── 简化导航
    └── 触摸优化

平板 (768px - 1024px)
    │
    ├── 双列布局
    └── 混合交互

桌面 (> 1024px)
    │
    ├── 多列布局
    ├── 完整功能
    └── 鼠标交互
```

