<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Â≠∏ËôüÊäΩÁ±§Á≥ªÁµ±">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="theme-color" content="#667eea">
  <meta name="HandheldFriendly" content="true">
  <meta name="MobileOptimized" content="width">
  <title>Â≠∏ËôüÊäΩÁ±§Á≥ªÁµ±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Noto Sans TC', 'Montserrat', 'Segoe UI', Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0.5rem;
      overflow: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }

    .main-title {
      color: #fff;
      font-size: 1.8rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .main-title .icon {
      font-size: 1.8rem;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .content-area {
      flex: 1;
      display: flex;
      gap: 0.5rem;
      overflow: hidden;
      min-height: 0;
    }

    .left-panel {
      flex: 0 0 280px;
      background: rgba(255,255,255,0.95);
      border-radius: 0.75rem;
      padding: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .right-panel {
      flex: 1;
      background: rgba(255,255,255,0.95);
      border-radius: 0.75rem;
      padding: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .form-group {
      margin-bottom: 0.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.25rem;
      color: #374151;
      font-weight: 600;
      font-size: 0.8rem;
    }

    .form-control {
      width: 100%;
      padding: 0.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      background: #fff;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-control.textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .mode-section {
      background: rgba(102, 126, 234, 0.05);
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      border: 2px solid rgba(102, 126, 234, 0.1);
      transition: all 0.3s ease;
    }

    .mode-section.active {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
    }

    .mode-section h3 {
      margin: 0 0 0.5rem 0;
      color: #4f46e5;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      color: #374151;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .btn-secondary:hover {
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.25rem;
      margin-bottom: 0.5rem;
    }

    .quick-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.4rem;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .quick-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .result-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .result {
      flex: 1;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 150px;
    }

    .result.error {
      color: #ef4444;
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      border-color: #fecaca;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .result-header .icon {
      font-size: 2rem;
      filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.3));
    }

    .result-header .title {
      font-size: 1.5rem;
      color: #059669;
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
    }

    .result-content {
      text-align: center;
      font-size: 1.2rem;
      color: #2563eb;
      font-weight: 600;
      line-height: 1.6;
    }

    .result-numbers {
      background: linear-gradient(135deg, #e0f2fe 0%, #f0fdfa 100%);
      border-radius: 1rem;
      padding: 1rem;
      border: 2px solid #60a5fa;
      margin-top: 1rem;
      font-size: 1.3rem;
      color: #2563eb;
      font-weight: 700;
      text-align: center;
    }

    .history-section {
      background: rgba(102, 126, 234, 0.05);
      border-radius: 0.5rem;
      padding: 0.5rem;
      border: 1px solid rgba(102, 126, 234, 0.2);
      max-height: 120px;
      overflow: hidden;
    }

    .history-section h4 {
      margin: 0 0 0.25rem 0;
      color: #4f46e5;
      font-size: 0.8rem;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.25rem;
      margin: 0.125rem 0;
      background: white;
      border-radius: 0.25rem;
      border-left: 2px solid #667eea;
      font-size: 0.7rem;
    }

    .history-item .time {
      color: #6b7280;
      font-size: 0.6rem;
    }

    /* ÂãïÁï´ÊïàÊûú */
    @keyframes roll {
      0% { transform: translateY(0); opacity: 1; }
      50% { transform: translateY(-20px); opacity: 0.5; }
      100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .rolling {
      animation: roll 0.5s ease-in-out;
    }

    .result.show {
      animation: fadeInUp 0.6s ease-out;
    }

    .result-numbers .highlight {
      animation: pulse 0.8s ease-in-out;
      color: #dc2626;
      font-weight: 900;
    }

    /* ÈüøÊáâÂºèË®≠Ë®à */
    @media (max-width: 768px) {
      .content-area {
        flex-direction: column;
      }

      .left-panel {
        flex: 0 0 auto;
        max-height: 40vh;
      }

      .main-title {
        font-size: 1.5rem;
      }

      .main-title .icon {
        font-size: 1.5rem;
      }

      .quick-actions {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .main-container {
        padding: 0.25rem;
      }

      .left-panel,
      .right-panel {
        padding: 0.5rem;
      }

      .main-title {
        font-size: 1.2rem;
      }

      .main-title .icon {
        font-size: 1.2rem;
      }

      .quick-actions {
        grid-template-columns: 1fr;
      }
    }

  </style>
</head>
<body>
  <div class="main-container">
    <div class="header">
      <h1 class="main-title">
        <span class="icon">üé≤</span>
        Â≠∏ËôüÊäΩÁ±§Á≥ªÁµ±
      </h1>
    </div>

    <div class="content-area">
      <!-- Â∑¶ÂÅ¥ÊéßÂà∂Èù¢Êùø -->
      <div class="left-panel">
        <!-- Ê®°ÂºèÈÅ∏Êìá -->
        <div class="form-group">
          <label for="mainMode">ÈÅ∏ÊìáÊäΩÁ±§Ê®°ÂºèÔºö</label>
          <select id="mainMode" class="form-control" onchange="toggleMainMode()">
            <option value="number">Êåâ‰∫∫Êï∏ÊäΩÁ±§</option>
            <option value="name">ÊåâÂßìÂêçÊäΩÁ±§</option>
          </select>
        </div>

        <!-- Êåâ‰∫∫Êï∏ÊäΩÁ±§ÂçÄÂüü -->
        <div id="numberModeSection" class="mode-section active">
          <h3>
            <span>üî¢</span>Êåâ‰∫∫Êï∏ÊäΩÁ±§
          </h3>
          <div class="form-group">
            <label for="total">Á∏Ω‰∫∫Êï∏ÔºàÂ≠∏ËôüÂæû 1 ÈñãÂßãÔºâÔºö</label>
            <input type="number" id="total" class="form-control" min="1" max="999" value="30">
          </div>
          <div class="form-group">
            <label for="drawCount">ÊäΩÂèñ‰∫∫Êï∏Ôºö</label>
            <input type="number" id="drawCount" class="form-control" min="1" value="1">
          </div>
          <div class="form-group">
            <label for="numberMode">ÊäΩÂèñÊ®°ÂºèÔºö</label>
            <select id="numberMode" class="form-control">
              <option value="all">ÂÖ®ÈÉ®Â≠∏Ëôü</option>
              <option value="odd">Âè™ÊäΩÂ•áÊï∏Â≠∏Ëôü</option>
              <option value="even">Âè™ÊäΩÂÅ∂Êï∏Â≠∏Ëôü</option>
            </select>
          </div>
        </div>

        <!-- ÊåâÂßìÂêçÊäΩÁ±§ÂçÄÂüü -->
        <div id="nameModeSection" class="mode-section" style="display: none;">
          <h3>
            <span>üë•</span>ÊåâÂßìÂêçÊäΩÁ±§
          </h3>
          <div class="form-group">
            <label for="names">Ëº∏ÂÖ•ÂßìÂêçÔºàÊØèË°å‰∏ÄÂÄãÔºâÔºö</label>
            <textarea id="names" class="form-control textarea" rows="4" placeholder="‰æãÂ¶ÇÔºö&#10;Âºµ‰∏â&#10;ÊùéÂõõ&#10;Áéã‰∫î&#10;Ë∂ôÂÖ≠"></textarea>
          </div>
          
          <div class="form-group">
            <label for="nameDrawMode">ÊäΩÁ±§Ê®°ÂºèÔºö</label>
            <select id="nameDrawMode" class="form-control" onchange="toggleNameDrawOptions()">
              <option value="group">ÂàÜÁµÑÊ®°Âºè</option>
              <option value="oneByOne">ÈÄê‰∏ÄÊäΩÁ±§</option>
              <option value="auto">Ëá™ÂãïÊäΩÁ±§</option>
            </select>
          </div>
          
          <!-- ÂàÜÁµÑÊ®°ÂºèÈÅ∏È†Ö -->
          <div id="groupOptions" class="form-group">
            <label for="groupCount">ÂàÜÁµÑÊï∏ÈáèÔºö</label>
            <input type="number" id="groupCount" class="form-control" min="2" max="10" value="2">
          </div>
          
          <!-- Ëá™ÂãïÊäΩÁ±§ÈÅ∏È†Ö -->
          <div id="autoOptions" class="form-group" style="display: none;">
            <label for="autoDrawCount">ÊäΩÂèñ‰∫∫Êï∏Ôºö</label>
            <input type="number" id="autoDrawCount" class="form-control" min="1" value="1">
          </div>
          
          <!-- ÈÄê‰∏ÄÊäΩÁ±§ÈÅ∏È†Ö -->
          <div id="oneByOneOptions" class="form-group" style="display: none;">
            <label for="oneByOneGroupCount">ÂàÜÁµÑÊï∏ÈáèÔºö</label>
            <input type="number" id="oneByOneGroupCount" class="form-control" min="2" max="10" value="2">
          </div>
        </div>

        <!-- ÊäΩÁ±§ÊåâÈàï -->
        <button class="btn" onclick="drawLot()">üéØ ÊäΩÁ±§ÔºÅ</button>

        <!-- Âø´Êç∑Êìç‰Ωú -->
        <div class="quick-actions">
          <button class="quick-btn" onclick="quickDraw(1)">Âø´ÈÄüÊäΩ1‰∫∫</button>
          <button class="quick-btn" onclick="quickDraw(5)">Âø´ÈÄüÊäΩ5‰∫∫</button>
          <button class="quick-btn" onclick="quickDraw(10)">Âø´ÈÄüÊäΩ10‰∫∫</button>
        </div>
      </div>

      <!-- Âè≥ÂÅ¥ÁµêÊûúÈù¢Êùø -->
      <div class="right-panel">
        <div class="result-area">
          <div class="result" id="result">
            <div style="text-align: center; color: #6b7280; font-size: 0.9rem;">
              <div style="font-size: 2rem; margin-bottom: 0.5rem;">üé≤</div>
              <div>ÈªûÊìä„ÄåÊäΩÁ±§ÔºÅ„ÄçÈñãÂßãÊäΩÁ±§</div>
            </div>
          </div>

          <!-- Ê≠∑Âè≤Ë®òÈåÑ -->
          <div id="historySection" class="history-section" style="display: none;">
            <h4>ÊäΩÁ±§Ê≠∑Âè≤</h4>
            <div id="historyList"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ËøîÂõû‰∏ªÁ≥ªÁªüÊåâÈíÆÂäüËÉΩ
    (function() {
        'use strict';
        
        // ÂàõÂª∫ËøîÂõû‰∏ªÁ≥ªÁªüÊåâÈíÆÁöÑÊ†∑Âºè
        const style = document.createElement('style');
        style.textContent = `
            .back-to-main-btn {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 9999;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 50px;
                padding: 12px 20px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
            
            .back-to-main-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            }
            
            .back-to-main-btn:active {
                transform: translateY(0);
            }
            
            .back-to-main-btn .icon {
                font-size: 16px;
            }
            
            /* ÂìçÂ∫îÂºèËÆæËÆ° */
            @media (max-width: 768px) {
                .back-to-main-btn {
                    top: 15px;
                    left: 15px;
                    padding: 10px 16px;
                    font-size: 12px;
                }
                
                .back-to-main-btn .icon {
                    font-size: 14px;
                }
            }
            
            @media (max-width: 480px) {
                .back-to-main-btn {
                    top: 10px;
                    left: 10px;
                    padding: 8px 12px;
                    font-size: 11px;
                }
                
                .back-to-main-btn .icon {
                    font-size: 12px;
                }
            }
        `;
        
        // Ê∑ªÂä†Ê†∑ÂºèÂà∞È°µÈù¢
        document.head.appendChild(style);
        
        // ÂàõÂª∫ËøîÂõû‰∏ªÁ≥ªÁªüÊåâÈíÆ
        function createBackButton() {
            const button = document.createElement('button');
            button.className = 'back-to-main-btn';
            button.innerHTML = '<span class="icon">üè†</span>ËøîÂõû‰∏ªÁ≥ªÁµ±';
            button.title = 'ËøîÂõû‰∏ªÁ≥ªÁªü';
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            button.addEventListener('click', function() {
                // Â∞ùËØïÂ§öÁßçÊñπÂºèËøîÂõû‰∏ªÁ≥ªÁªü
                if (window.parent && window.parent !== window) {
                    // Â¶ÇÊûúÂú®iframe‰∏≠ÔºåÈÄöÁü•Áà∂Á™óÂè£
                    window.parent.postMessage({ action: 'backToMain' }, '*');
                } else if (window.opener) {
                    // Â¶ÇÊûúÊòØÈÄöËøáwindow.openÊâìÂºÄÁöÑÔºåÂÖ≥Èó≠ÂΩìÂâçÁ™óÂè£
                    window.close();
                } else {
                    // Áõ¥Êé•Ë∑≥ËΩ¨Âà∞‰∏ªÁ≥ªÁªü
                    window.location.href = '../index.html';
                }
            });
            
            return button;
        }
        
        // Á≠âÂæÖDOMÂä†ËΩΩÂÆåÊàêÂêéÊ∑ªÂä†ÊåâÈíÆ
        function initBackButton() {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ËøîÂõûÊåâÈíÆ
            if (document.querySelector('.back-to-main-btn')) {
                return;
            }
            
            const button = createBackButton();
            document.body.appendChild(button);
            
            // ÁõëÂê¨Êù•Ëá™Áà∂Á™óÂè£ÁöÑÊ∂àÊÅØ
            window.addEventListener('message', function(event) {
                if (event.data && event.data.action === 'backToMain') {
                    window.location.href = '../index.html';
                }
            });
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initBackButton);
        } else {
            initBackButton();
        }
    })();
  </script>
  <script>
    // ÂÖ®Â±ÄËÆäÊï∏
    let drawHistory = [];
    
    function drawLot() {
      const mainMode = document.getElementById('mainMode').value;
      const resultDiv = document.getElementById('result');
      resultDiv.className = 'result';
      
      // Ê∑ªÂä†ÊäΩÁ±§ÂãïÁï´
      resultDiv.classList.add('rolling');
      setTimeout(() => {
        resultDiv.classList.remove('rolling');
        resultDiv.classList.add('show');
      }, 500);
      
      if (mainMode === 'name') {
        // ÂßìÂêçÊäΩÁ±§Ê®°Âºè
        const namesText = document.getElementById('names').value.trim();
        const names = namesText.split('\n').map(name => name.trim()).filter(name => name !== '');
        if (names.length === 0) {
          resultDiv.innerHTML = '<div class="result error">Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÂßìÂêçÔºÅ</div>';
          return;
        }
        
        const nameDrawMode = document.getElementById('nameDrawMode').value;
        
        if (nameDrawMode === 'group') {
          // ÂàÜÁµÑÊ®°Âºè
          const groupCount = parseInt(document.getElementById('groupCount').value, 10);
          if (isNaN(groupCount) || groupCount < 2 || groupCount > 10) {
            resultDiv.innerHTML = '<div class="result error">Ë´ãËº∏ÂÖ• 2 ~ 10 ‰πãÈñìÁöÑÂàÜÁµÑÊï∏ÈáèÔºÅ</div>';
            return;
          }
          
          // Ê¥óÁâåÂßìÂêç
          const shuffledNames = [...names];
          for (let i = shuffledNames.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledNames[i], shuffledNames[j]] = [shuffledNames[j], shuffledNames[i]];
          }
          
          // ÂàÜÁµÑ
          const groups = [];
          const namesPerGroup = Math.ceil(shuffledNames.length / groupCount);
          for (let i = 0; i < groupCount; i++) {
            const start = i * namesPerGroup;
            const end = Math.min((i + 1) * namesPerGroup, shuffledNames.length);
            if (start < shuffledNames.length) {
              groups.push(shuffledNames.slice(start, end));
            }
          }
          
          // È°ØÁ§∫ÂàÜÁµÑÁµêÊûú
          let groupsHtml = '';
          groups.forEach((group, index) => {
            groupsHtml += `<div style="margin-bottom: 1rem; padding: 1rem; background: rgba(96, 165, 250, 0.1); border-radius: 0.75rem; border-left: 4px solid #60a5fa;">
              <strong style="color: #1e40af; font-size: 1.1em;">Á¨¨ ${index + 1} ÁµÑÔºö</strong><br>
              <span style="color: #2563eb; font-size: 1.05em;">${group.join('„ÄÅ')}</span>
            </div>`;
          });
          
          resultDiv.innerHTML = `
            <div class='result-header'>
              <span class='icon'>üë•</span>
              <span class='title'>ÂàÜÁµÑÁµêÊûú</span>
            </div>
            <div class='result-numbers' style="width: 100%; max-width: none;">
              ${groupsHtml}
            </div>
          `;
          
          // ‰øùÂ≠òÊ≠∑Âè≤Ë®òÈåÑ
          const groupSummary = groups.map((group, index) => `Á¨¨${index + 1}ÁµÑ: ${group.join('„ÄÅ')}`).join('; ');
          saveHistory(`ÂàÜÁµÑÁµêÊûú: ${groupSummary}`, 'ÊåâÂßìÂêçÂàÜÁµÑ');
          
        } else if (nameDrawMode === 'oneByOne') {
          // ÈÄê‰∏ÄÊäΩÁ±§Ê®°Âºè
          const groupCount = parseInt(document.getElementById('oneByOneGroupCount').value, 10);
          if (isNaN(groupCount) || groupCount < 2 || groupCount > 10) {
            resultDiv.innerHTML = '<div class="result error">Ë´ãËº∏ÂÖ• 2 ~ 10 ‰πãÈñìÁöÑÂàÜÁµÑÊï∏ÈáèÔºÅ</div>';
            return;
          }
          
          if (!window.remainingNames || window.remainingNames.length === 0) {
            // ÂàùÂßãÂåñÊàñÈáçÊñ∞ÈñãÂßã
            window.remainingNames = [...names];
            window.groups = Array.from({length: groupCount}, () => []);
            // Ê¥óÁâå
            for (let i = window.remainingNames.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [window.remainingNames[i], window.remainingNames[j]] = [window.remainingNames[j], window.remainingNames[i]];
            }
          }
          
          // ÊäΩÂèñ‰∏ÄÂÄã‰∫∫
          const selected = window.remainingNames.pop();
          
          // ÂàÜÈÖçÂà∞ÁµÑÂà•ÔºàËº™ÊµÅÂàÜÈÖçÔºâ
          const currentGroupIndex = (names.length - window.remainingNames.length - 1) % groupCount;
          window.groups[currentGroupIndex].push(selected);
          
          // È°ØÁ§∫ÁµêÊûú
          let groupsHtml = '';
          window.groups.forEach((group, index) => {
            if (group.length > 0) {
              groupsHtml += `<div style="margin-bottom: 0.5rem; padding: 0.75rem; background: rgba(96, 165, 250, 0.1); border-radius: 0.5rem; border-left: 3px solid #60a5fa;">
                <strong style="color: #1e40af; font-size: 0.9em;">Á¨¨ ${index + 1} ÁµÑÔºö</strong>
                <span style="color: #2563eb; font-size: 0.85em;"> ${group.join('„ÄÅ')}</span>
              </div>`;
            }
          });
          
          resultDiv.innerHTML = `
            <div class='result-header'>
              <span class='icon'>üéØ</span>
              <span class='title'>ÊäΩ‰∏≠ÂßìÂêç</span>
            </div>
            <div class='result-numbers'>
              <div style="font-size: 2.5em; margin: 1rem 0; color: #dc2626; font-weight: 900;">${selected}</div>
              <div style="margin-top: 1rem; text-align: center; color: #059669; font-size: 1.1em; font-weight: bold;">
                ÂàÜÈÖçÂà∞Á¨¨ ${currentGroupIndex + 1} ÁµÑ
              </div>
            </div>
            <div style="margin-top: 1rem; text-align: center; color: #6b7280; font-size: 0.9em;">
              Ââ©È§ò ${window.remainingNames.length} ‰∫∫
            </div>
            ${groupsHtml ? `
              <div style="margin-top: 1rem;">
                <div style="text-align: center; color: #374151; font-size: 1em; font-weight: bold; margin-bottom: 0.5rem;">Áï∂ÂâçÂàÜÁµÑÁãÄÊ≥Å</div>
                <div style="max-height: 150px; overflow-y: auto;">
                  ${groupsHtml}
                </div>
              </div>
            ` : ''}
            ${window.remainingNames.length === 0 ? 
              '<div style="margin-top: 1rem;"><button onclick="resetOneByOne()" class="btn btn-secondary">üîÑ ÈáçÊñ∞ÈñãÂßã</button></div>' 
              : ''
            }
          `;
          
          // ‰øùÂ≠òÊ≠∑Âè≤Ë®òÈåÑ
          saveHistory(`ÊäΩ‰∏≠: ${selected} (ÂàÜÈÖçÂà∞Á¨¨${currentGroupIndex + 1}ÁµÑ)`, 'ÊåâÂßìÂêçÈÄê‰∏ÄÊäΩÁ±§');
          
        } else if (nameDrawMode === 'auto') {
          // Ëá™ÂãïÊäΩÁ±§Ê®°Âºè
          const autoDrawCount = parseInt(document.getElementById('autoDrawCount').value, 10);
          if (isNaN(autoDrawCount) || autoDrawCount < 1 || autoDrawCount > names.length) {
            resultDiv.innerHTML = `<div class="result error">Ë´ãËº∏ÂÖ• 1 ~ ${names.length} ‰πãÈñìÁöÑÊäΩÂèñ‰∫∫Êï∏ÔºÅ</div>`;
            return;
          }
          
          // Ê¥óÁâåÂßìÂêç
          const shuffledNames = [...names];
          for (let i = shuffledNames.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledNames[i], shuffledNames[j]] = [shuffledNames[j], shuffledNames[i]];
          }
          
          // ÊäΩÂèñÊåáÂÆö‰∫∫Êï∏
          const selected = shuffledNames.slice(0, autoDrawCount);
          
          // È°ØÁ§∫ÁµêÊûú
          let selectedHtml = '';
          for (let i = 0; i < selected.length; i += 3) {
            selectedHtml += `<div style="margin-bottom: 0.5rem;">${selected.slice(i, i+3).join('„ÄÅ')}</div>`;
          }
          
          resultDiv.innerHTML = `
            <div class='result-header'>
              <span class='icon'>üéâ</span>
              <span class='title'>ÊäΩ‰∏≠ÂßìÂêç</span>
            </div>
            <div class='result-numbers'>
              ${selectedHtml}
            </div>
          `;
          
          // ‰øùÂ≠òÊ≠∑Âè≤Ë®òÈåÑ
          saveHistory(`ÊäΩ‰∏≠ÂßìÂêç: ${selected.join('„ÄÅ')}`, 'ÊåâÂßìÂêçËá™ÂãïÊäΩÁ±§');
        }
        
        resultDiv.classList.remove('error');
        
        // Êí≠ÊîæÈü≥Êïà
        try {
          playSound();
        } catch (e) {
          // Èü≥ÊïàÊí≠ÊîæÂ§±ÊïóÊôÇÈùúÈªòËôïÁêÜ
        }
      } else {
        // Â≠∏ËôüÊäΩÁ±§Ê®°Âºè
        const total = parseInt(document.getElementById('total').value, 10);
        const drawCount = parseInt(document.getElementById('drawCount').value, 10);
        const numberMode = document.getElementById('numberMode').value;
        
        if (isNaN(total) || total < 1) {
          resultDiv.innerHTML = '<div class="result error">Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÁ∏Ω‰∫∫Êï∏ÔºÅ</div>';
          return;
        }
        
        let pool = [];
        for (let i = 1; i <= total; i++) {
          if (numberMode === 'odd' && i % 2 === 0) continue;
          if (numberMode === 'even' && i % 2 !== 0) continue;
          pool.push(i);
        }
        
        if (pool.length === 0) {
          resultDiv.innerHTML = '<div class="result error">Ê≤íÊúâÂèØÊäΩÂèñÁöÑÂ≠∏ËôüÔºÅ</div>';
          return;
        }
        if (isNaN(drawCount) || drawCount < 1 || drawCount > pool.length) {
          resultDiv.innerHTML = `<div class="result error">Ë´ãËº∏ÂÖ• 1 ~ ${pool.length} ‰πãÈñìÁöÑÊäΩÂèñ‰∫∫Êï∏ÔºÅ</div>`;
          return;
        }
        
        // Ê¥óÁâå
        for (let i = pool.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [pool[i], pool[j]] = [pool[j], pool[i]];
        }
        const selected = pool.slice(0, drawCount);
        
        // ÊØèË°åÊúÄÂ§ö5ÂÄãÔºåË°åÊï∏‰∏çÈôê
        let numbersHtml = '';
        for (let i = 0; i < selected.length; i += 5) {
          numbersHtml += `<div style="margin-bottom: 0.5rem;">${selected.slice(i, i+5).join(', ')}</div>`;
        }
        resultDiv.innerHTML = `
          <div class='result-header'>
            <span class='icon'>üéâ</span>
            <span class='title'>ÊäΩ‰∏≠Â≠∏Ëôü</span>
          </div>
          <div class='result-numbers'>${numbersHtml}</div>
        `;
        resultDiv.classList.remove('error');
        
        // ‰øùÂ≠òÊ≠∑Âè≤Ë®òÈåÑ
        saveHistory(`ÊäΩ‰∏≠Â≠∏Ëôü: ${selected.join(', ')}`, 'Êåâ‰∫∫Êï∏ÊäΩÁ±§');
        
        // Êí≠ÊîæÈü≥Êïà
        try {
          playSound();
        } catch (e) {
          // Èü≥ÊïàÊí≠ÊîæÂ§±ÊïóÊôÇÈùúÈªòËôïÁêÜ
        }
      }
    }

    function toggleMainMode() {
      const numberModeSection = document.getElementById('numberModeSection');
      const nameModeSection = document.getElementById('nameModeSection');
      const mainModeSelect = document.getElementById('mainMode');
      const isNameMode = mainModeSelect.value === 'name';
      
      if (isNameMode) {
        numberModeSection.style.display = 'none';
        numberModeSection.classList.remove('active');
        nameModeSection.style.display = 'block';
        nameModeSection.classList.add('active');
      } else {
        numberModeSection.style.display = 'block';
        numberModeSection.classList.add('active');
        nameModeSection.style.display = 'none';
        nameModeSection.classList.remove('active');
      }
      
      // Ê∏ÖÁ©∫ÁµêÊûúÂçÄÂüü
      document.getElementById('result').innerHTML = '<div style="text-align: center; color: #6b7280; font-size: 0.9rem;"><div style="font-size: 2rem; margin-bottom: 0.5rem;">üé≤</div><div>ÈªûÊìä„ÄåÊäΩÁ±§ÔºÅ„ÄçÈñãÂßãÊäΩÁ±§</div></div>';
    }

    function toggleNameDrawOptions() {
      const nameDrawMode = document.getElementById('nameDrawMode').value;
      const groupOptions = document.getElementById('groupOptions');
      const autoOptions = document.getElementById('autoOptions');
      const oneByOneOptions = document.getElementById('oneByOneOptions');
      
      // Èö±ËóèÊâÄÊúâÈÅ∏È†Ö
      groupOptions.style.display = 'none';
      autoOptions.style.display = 'none';
      oneByOneOptions.style.display = 'none';
      
      // Ê†πÊìöÈÅ∏ÊìáÁöÑÊ®°ÂºèÈ°ØÁ§∫Â∞çÊáâÈÅ∏È†Ö
      if (nameDrawMode === 'group') {
        groupOptions.style.display = 'block';
      } else if (nameDrawMode === 'auto') {
        autoOptions.style.display = 'block';
      } else if (nameDrawMode === 'oneByOne') {
        oneByOneOptions.style.display = 'block';
      }
    }

    // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñ
    window.onload = function() {
      toggleMainMode();
    }

    function resetOneByOne() {
      window.remainingNames = null;
      window.groups = null;
      document.getElementById('result').innerHTML = '<div style="text-align: center; color: #6b7280; font-size: 0.9rem;"><div style="font-size: 2rem; margin-bottom: 0.5rem;">üé≤</div><div>ÈªûÊìä„ÄåÊäΩÁ±§ÔºÅ„ÄçÈñãÂßãÊäΩÁ±§</div></div>';
    }
    
    // Âø´Êç∑ÊäΩÁ±§ÂäüËÉΩ
    function quickDraw(count) {
      const mainMode = document.getElementById('mainMode').value;
      
      if (mainMode === 'number') {
        document.getElementById('drawCount').value = count;
      } else if (mainMode === 'name') {
        document.getElementById('nameDrawMode').value = 'auto';
        document.getElementById('autoDrawCount').value = count;
        toggleNameDrawOptions();
      }
      
      drawLot();
    }
    
    // ‰øùÂ≠òÊ≠∑Âè≤Ë®òÈåÑ
    function saveHistory(result, mode) {
      const historyItem = {
        time: new Date().toLocaleString('zh-TW'),
        result: result,
        mode: mode
      };
      
      drawHistory.unshift(historyItem);
      if (drawHistory.length > 10) {
        drawHistory.pop(); // Âè™‰øùÁïôÊúÄËøë10Á≠Ü
      }
      
      updateHistoryDisplay();
    }
    
    // Êõ¥Êñ∞Ê≠∑Âè≤Ë®òÈåÑÈ°ØÁ§∫
    function updateHistoryDisplay() {
      const historySection = document.getElementById('historySection');
      const historyList = document.getElementById('historyList');
      
      if (drawHistory.length > 0) {
        historySection.style.display = 'block';
        historyList.innerHTML = drawHistory.map(item => `
          <div class="history-item">
            <span>${item.result}</span>
            <span class="time">${item.time}</span>
          </div>
        `).join('');
      } else {
        historySection.style.display = 'none';
      }
    }
    
    // Ê∏ÖÁ©∫Ê≠∑Âè≤Ë®òÈåÑ
    function clearHistory() {
      drawHistory = [];
      updateHistoryDisplay();
    }
    
    // ÂåØÂá∫ÁµêÊûú
    function exportResult() {
      const resultDiv = document.getElementById('result');
      if (resultDiv.innerHTML.trim() === '') {
        alert('Ê≤íÊúâÂèØÂåØÂá∫ÁöÑÁµêÊûúÔºÅ');
        return;
      }
      
      const resultText = resultDiv.innerText;
      const blob = new Blob([resultText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ÊäΩÁ±§ÁµêÊûú_${new Date().toLocaleDateString('zh-TW')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Ê∑ªÂä†Èü≥ÊïàÔºàÂèØÈÅ∏Ôºâ
    function playSound() {
      // Á∞°ÂñÆÁöÑÈü≥ÊïàÂØ¶Áèæ
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.2);
    }
  </script>
</body>
</html>