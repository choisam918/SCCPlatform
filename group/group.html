<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="åˆ†çµ„å·¥å…·">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="theme-color" content="#667eea">
  <meta name="HandheldFriendly" content="true">
  <meta name="MobileOptimized" content="width">
  <title>åˆ†çµ„å·¥å…·</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    body {
      font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      overflow: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 1rem;
      flex-shrink: 0;
    }

    .main-title {
      color: #fff;
      font-size: 2rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 0.5rem;
    }

    .content-area {
      flex: 1;
      display: flex;
      gap: 1rem;
      overflow: hidden;
      min-height: 0;
    }

    .left-panel {
      flex: 0 0 300px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .right-panel {
      flex: 1;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .mode-select {
      margin-bottom: 1rem;
      text-align: center;
    }

    .mode-select label {
      display: inline-block;
      margin: 0 1rem 0 0;
      font-size: 0.9rem;
      cursor: pointer;
      color: #374151;
      font-weight: 500;
    }

    .mode-select input[type="radio"] {
      margin-right: 0.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #374151;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 1rem;
      background: #fff;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-control.textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      width: 100%;
      margin-bottom: 1rem;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-secondary:hover {
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .loading {
      position: relative;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid transparent;
      border-top: 2px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .stats {
      background: linear-gradient(135deg, #e0f2fe 0%, #f0fdfa 100%);
      border: 2px solid #60a5fa;
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      font-size: 0.8rem;
      color: #1e40af;
      font-weight: 600;
      text-align: center;
    }

    .group {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid #e2e8f0;
      border-radius: 0.5rem;
      margin: 0.5rem 0;
      padding: 0.75rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      font-size: 0.9rem;
      color: #374151;
      transition: all 0.3s ease;
      position: relative;
    }

    .group:hover {
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .group strong {
      color: #667eea;
      font-size: 1rem;
      font-weight: 700;
    }

    .copy-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(102, 126, 234, 0.1);
      border: none;
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.7rem;
      color: #667eea;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .copy-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: scale(1.05);
    }

    .copy-btn.copied {
      background: #10b981;
      color: white;
    }

    .error {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border: 2px solid #ef4444;
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin: 0.75rem 0;
      color: #dc2626;
      font-size: 0.8rem;
      font-weight: 600;
      text-align: center;
    }

    .success {
      background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
      border: 2px solid #22c55e;
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin: 0.75rem 0;
      color: #166534;
      font-size: 0.8rem;
      font-weight: 600;
      text-align: center;
    }

    .empty-state {
      text-align: center;
      padding: 1rem;
      color: #6b7280;
    }

    .empty-state-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .empty-state-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #374151;
    }

    .empty-state-description {
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .content-area {
        flex-direction: column;
      }

      .left-panel {
        flex: 0 0 auto;
        max-height: 40vh;
      }

      .main-title {
        font-size: 1.5rem;
      }

      .group {
        margin: 0.25rem 0;
        padding: 0.5rem;
        font-size: 0.8rem;
      }

      .group strong {
        font-size: 0.9rem;
      }

      .copy-btn {
        padding: 0.2rem 0.4rem;
        font-size: 0.6rem;
      }
    }

    @media (max-width: 480px) {
      .main-container {
        padding: 0.5rem;
      }

      .left-panel,
      .right-panel {
        padding: 0.75rem;
      }

      .main-title {
        font-size: 1.2rem;
      }

      .mode-select label {
        font-size: 0.8rem;
        margin: 0 0.5rem 0 0;
      }

      .group {
        margin: 0.2rem 0;
        padding: 0.4rem;
        font-size: 0.75rem;
      }

      .group strong {
        font-size: 0.85rem;
      }

      .copy-btn {
        padding: 0.15rem 0.3rem;
        font-size: 0.55rem;
        top: 0.3rem;
        right: 0.3rem;
      }

      .stats {
        padding: 0.5rem;
        font-size: 0.7rem;
        margin-bottom: 0.5rem;
      }
    }

    /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
    .left-panel::-webkit-scrollbar,
    .right-panel::-webkit-scrollbar {
      width: 6px;
    }

    .left-panel::-webkit-scrollbar-track,
    .right-panel::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.1);
      border-radius: 3px;
    }

    .left-panel::-webkit-scrollbar-thumb,
    .right-panel::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.5);
      border-radius: 3px;
    }

    .left-panel::-webkit-scrollbar-thumb:hover,
    .right-panel::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.7);
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="header">
      <h1 class="main-title">åˆ†çµ„å·¥å…·</h1>
    </div>

    <div class="content-area">
      <!-- å·¦å´æ§åˆ¶é¢æ¿ -->
      <div class="left-panel">
        <div class="mode-select">
          <label><input type="radio" name="mode" value="random" checked onchange="switchMode()"> éš¨æ©Ÿåˆ†çµ„</label>
          <label><input type="radio" name="mode" value="custom" onchange="switchMode()"> å¡«å¯«éƒ¨åˆ†å­¸è™Ÿå¾Œåˆ†çµ„</label>
        </div>

        <div id="randomMode">
          <div class="form-group">
            <label for="total">ç¸½äººæ•¸ï¼š</label>
            <input type="number" id="total" class="form-control" min="1" value="12">
          </div>
          <div class="form-group">
            <label for="groups">çµ„æ•¸ï¼š</label>
            <input type="number" id="groups" class="form-control" min="1" value="3">
          </div>
        </div>

        <div id="customMode" style="display:none;">
          <div class="form-group">
            <label for="studentIds">å·²çŸ¥å­¸è™Ÿï¼ˆæ¯è¡Œä¸€å€‹ï¼‰ï¼š</label>
            <textarea id="studentIds" class="form-control textarea" placeholder="ä¾‹å¦‚ï¼š&#10;A12345678&#10;A23456789"></textarea>
          </div>
          <div class="form-group">
            <label for="total2">ç¸½äººæ•¸ï¼š</label>
            <input type="number" id="total2" class="form-control" min="1" value="12">
          </div>
          <div class="form-group">
            <label for="groups2">çµ„æ•¸ï¼š</label>
            <input type="number" id="groups2" class="form-control" min="1" value="3">
          </div>
        </div>

        <button onclick="splitGroups()" id="splitBtn" class="btn">
          åˆ†çµ„
        </button>
      </div>

      <!-- å³å´çµæœé¢æ¿ -->
      <div class="right-panel">
        <div class="result-area">
          <div id="stats" class="stats" style="display:none;"></div>
          <div id="result">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ‘¥</div>
              <div class="empty-state-title">æº–å‚™åˆ†çµ„</div>
              <div class="empty-state-description">è¨­å®šåƒæ•¸å¾Œé»æ“Šã€Œåˆ†çµ„ã€æŒ‰éˆ•é–‹å§‹åˆ†çµ„</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // è¿”å›ä¸»ç³»ç»ŸæŒ‰é’®åŠŸèƒ½
    (function() {
        'use strict';
        
        // åˆ›å»ºè¿”å›ä¸»ç³»ç»ŸæŒ‰é’®çš„æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            .back-to-main-btn {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 9999;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 50px;
                padding: 12px 20px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
            
            .back-to-main-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            }
            
            .back-to-main-btn:active {
                transform: translateY(0);
            }
            
            .back-to-main-btn .icon {
                font-size: 16px;
            }
            
            /* å“åº”å¼è®¾è®¡ */
            @media (max-width: 768px) {
                .back-to-main-btn {
                    top: 15px;
                    left: 15px;
                    padding: 10px 16px;
                    font-size: 12px;
                }
                
                .back-to-main-btn .icon {
                    font-size: 14px;
                }
            }
            
            @media (max-width: 480px) {
                .back-to-main-btn {
                    top: 10px;
                    left: 10px;
                    padding: 8px 12px;
                    font-size: 11px;
                }
                
                .back-to-main-btn .icon {
                    font-size: 12px;
                }
            }
        `;
        
        // æ·»åŠ æ ·å¼åˆ°é¡µé¢
        document.head.appendChild(style);
        
        // åˆ›å»ºè¿”å›ä¸»ç³»ç»ŸæŒ‰é’®
        function createBackButton() {
            const button = document.createElement('button');
            button.className = 'back-to-main-btn';
            button.innerHTML = '<span class="icon">ğŸ </span>è¿”å›ä¸»ç³»çµ±';
            button.title = 'è¿”å›ä¸»ç³»ç»Ÿ';
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            button.addEventListener('click', function() {
                // å°è¯•å¤šç§æ–¹å¼è¿”å›ä¸»ç³»ç»Ÿ
                if (window.parent && window.parent !== window) {
                    // å¦‚æœåœ¨iframeä¸­ï¼Œé€šçŸ¥çˆ¶çª—å£
                    window.parent.postMessage({ action: 'backToMain' }, '*');
                } else if (window.opener) {
                    // å¦‚æœæ˜¯é€šè¿‡window.openæ‰“å¼€çš„ï¼Œå…³é—­å½“å‰çª—å£
                    window.close();
                } else {
                    // ç›´æ¥è·³è½¬åˆ°ä¸»ç³»ç»Ÿ
                    window.location.href = '../index.html';
                }
            });
            
            return button;
        }
        
        // ç­‰å¾…DOMåŠ è½½å®Œæˆåæ·»åŠ æŒ‰é’®
        function initBackButton() {
            // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨è¿”å›æŒ‰é’®
            if (document.querySelector('.back-to-main-btn')) {
                return;
            }
            
            const button = createBackButton();
            document.body.appendChild(button);
            
            // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
            window.addEventListener('message', function(event) {
                if (event.data && event.data.action === 'backToMain') {
                    window.location.href = '../index.html';
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initBackButton);
        } else {
            initBackButton();
        }
    })();
  </script>
  <script>
    // é˜²æŠ–å‡½æ•°
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // ç¼“å­˜DOMå…ƒç´ 
    const elements = {
      randomMode: null,
      customMode: null,
      result: null,
      stats: null,
      splitBtn: null,
      total: null,
      groups: null,
      total2: null,
      groups2: null,
      studentIds: null
    };

    // åˆå§‹åŒ–æ—¶ç¼“å­˜DOMå…ƒç´ 
    document.addEventListener('DOMContentLoaded', function() {
      elements.randomMode = document.getElementById('randomMode');
      elements.customMode = document.getElementById('customMode');
      elements.result = document.getElementById('result');
      elements.stats = document.getElementById('stats');
      elements.splitBtn = document.getElementById('splitBtn');
      elements.total = document.getElementById('total');
      elements.groups = document.getElementById('groups');
      elements.total2 = document.getElementById('total2');
      elements.groups2 = document.getElementById('groups2');
      elements.studentIds = document.getElementById('studentIds');
      
      // æ·»åŠ è¾“å…¥éªŒè¯
      [elements.total, elements.groups, elements.total2, elements.groups2].forEach(input => {
        if (input) {
          input.addEventListener('input', validateInputs);
        }
      });
      
      // åˆå§‹éªŒè¯
      validateInputs();
    });

    // å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        // é™çº§æ–¹æ¡ˆ
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        return true;
      }
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message, type = 'success') {
      const messageDiv = document.createElement('div');
      messageDiv.className = type;
      messageDiv.textContent = message;
      elements.result.insertBefore(messageDiv, elements.result.firstChild);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 3000);
    }

    // è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€
    function setLoading(loading) {
      elements.splitBtn.disabled = loading;
      if (loading) {
        elements.splitBtn.classList.add('loading');
        elements.splitBtn.textContent = 'åˆ†çµ„ä¸­...';
      } else {
        elements.splitBtn.classList.remove('loading');
        elements.splitBtn.textContent = 'åˆ†çµ„';
      }
    }

    function switchMode() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      elements.randomMode.style.display = mode === 'random' ? '' : 'none';
      elements.customMode.style.display = mode === 'custom' ? '' : 'none';
      elements.result.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><div class="empty-state-title">æº–å‚™åˆ†çµ„</div><div class="empty-state-description">è¨­å®šåƒæ•¸å¾Œé»æ“Šã€Œåˆ†çµ„ã€æŒ‰éˆ•é–‹å§‹åˆ†çµ„</div></div>';
      elements.stats.style.display = 'none';
    }

    // ä¼˜åŒ–çš„Fisher-Yatesæ´—ç‰Œç®—æ³•
    function shuffle(array) {
      const shuffled = [...array]; // åˆ›å»ºå‰¯æœ¬é¿å…ä¿®æ”¹åŸæ•°ç»„
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // ä¼˜åŒ–çš„åˆ†ç»„ç®—æ³•
    function createGroups(members, groups) {
      const shuffled = shuffle(members);
      const result = [];
      const base = Math.floor(members.length / groups);
      const extra = members.length % groups;
      let idx = 0;
      
      for (let g = 1; g <= groups; g++) {
        const count = base + (g <= extra ? 1 : 0);
        const groupMembers = shuffled.slice(idx, idx + count);
        result.push({
          groupNum: g,
          members: groupMembers
        });
        idx += count;
      }
      return result;
    }

    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
    function showStats(groupsData, total, groups) {
      const avgSize = Math.floor(total / groups);
      const extraGroups = total % groups;
      const statsHTML = `
        <strong>åˆ†çµ„çµ±è¨ˆï¼š</strong><br>
        ç¸½äººæ•¸ï¼š${total} | çµ„æ•¸ï¼š${groups} | 
        å¹³å‡æ¯çµ„ï¼š${avgSize}äºº | 
        å‰${extraGroups}çµ„å„å¤š1äºº
      `;
      elements.stats.innerHTML = statsHTML;
      elements.stats.style.display = 'block';
    }

    // åˆ›å»ºå¸¦å¤åˆ¶åŠŸèƒ½çš„ç»„æ˜¾ç¤º
    function createGroupHTML(group) {
      const groupText = `ç¬¬${group.groupNum}çµ„ï¼š${group.members.join(', ')}`;
      return `
        <div class="group">
          <strong>ç¬¬${group.groupNum}çµ„ï¼š</strong> ${group.members.join(', ')}
          <button class="copy-btn" onclick="copyGroup('${groupText.replace(/'/g, "\\'")}')" title="è¤‡è£½æ­¤çµ„">
            è¤‡è£½
          </button>
        </div>
      `;
    }

    // å¤åˆ¶å•ä¸ªç»„
    async function copyGroup(text) {
      const success = await copyToClipboard(text);
      if (success) {
        const btn = event.target;
        btn.textContent = 'å·²è¤‡è£½';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'è¤‡è£½';
          btn.classList.remove('copied');
        }, 2000);
      }
    }

    // å¤åˆ¶æ‰€æœ‰åˆ†ç»„ç»“æœ
    async function copyAllGroups() {
      const groups = document.querySelectorAll('.group');
      let allText = '';
      groups.forEach(group => {
        const text = group.textContent.replace('è¤‡è£½', '').trim();
        allText += text + '\n';
      });
      
      const success = await copyToClipboard(allText);
      if (success) {
        showMessage('æ‰€æœ‰åˆ†çµ„çµæœå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼', 'success');
      }
    }

    // éªŒè¯è¾“å…¥
    function validateInput(total, groups) {
      if (isNaN(total) || isNaN(groups) || total < 1 || groups < 1) {
        throw new Error('è«‹è¼¸å…¥æ­£ç¢ºçš„æ•¸å­—');
      }
      if (groups > total) {
        throw new Error('çµ„æ•¸ä¸èƒ½è¶…éç¸½äººæ•¸');
      }
    }

    // ä¼˜åŒ–çš„åˆ†ç»„å‡½æ•°
    const splitGroups = debounce(async function() {
      setLoading(true);
      try {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        let total, groups, members;

        if (mode === 'random') {
          total = parseInt(elements.total.value, 10);
          groups = parseInt(elements.groups.value, 10);
          validateInput(total, groups);
          members = Array.from({length: total}, (_, i) => (i + 1).toString());
        } else {
          const ids = elements.studentIds.value
            .split('\n')
            .map(s => s.trim())
            .filter(s => s.length > 0);
          total = parseInt(elements.total2.value, 10);
          groups = parseInt(elements.groups2.value, 10);
          validateInput(total, groups);
          
          if (ids.length > total) {
            throw new Error('å­¸è™Ÿæ•¸é‡ä¸èƒ½è¶…éç¸½äººæ•¸');
          }

          // ä¼˜åŒ–ï¼šä½¿ç”¨Setæé«˜æŸ¥æ‰¾æ•ˆç‡
          const idSet = new Set(ids);
          const extra = [];
          for (let i = 1; i <= total; i++) {
            if (!idSet.has(i.toString())) {
              extra.push(i.toString());
            }
          }
          members = ids.concat(extra.slice(0, total - ids.length));
        }

        const groupsData = createGroups(members, groups);
        const resultHTML = groupsData.map(group => 
          createGroupHTML(group)
        ).join('');
        
        elements.result.innerHTML = resultHTML;
        showMessage('åˆ†çµ„æˆåŠŸï¼', 'success');
        showStats(groupsData, total, groups);
        
        // æ·»åŠ å¤åˆ¶æ‰€æœ‰ç»“æœçš„æŒ‰é’®
        if (groupsData.length > 0) {
          const copyAllBtn = document.createElement('button');
          copyAllBtn.textContent = 'è¤‡è£½æ‰€æœ‰åˆ†çµ„çµæœ';
          copyAllBtn.className = 'btn btn-secondary';
          copyAllBtn.onclick = copyAllGroups;
          elements.result.appendChild(copyAllBtn);
        }
      } catch (error) {
        showMessage(error.message, 'error');
      } finally {
        setLoading(false);
      }
    }, 300);

    // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        splitGroups();
      }
    });

    // å®æ—¶è¾“å…¥éªŒè¯
    function validateInputs() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      let total, groups;
      
      if (mode === 'random') {
        total = parseInt(elements.total.value, 10);
        groups = parseInt(elements.groups.value, 10);
      } else {
        total = parseInt(elements.total2.value, 10);
        groups = parseInt(elements.groups2.value, 10);
      }
      
      const isValid = !isNaN(total) && !isNaN(groups) && total > 0 && groups > 0 && groups <= total;
      elements.splitBtn.disabled = !isValid;
      
      return isValid;
    }
  </script>
</body>
</html>