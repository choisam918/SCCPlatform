# 系統架構流程圖

## 一、系統運作流程

### 1.1 檔案上傳流程
```
┌──────────────┐
│  教師開啟系統 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  選擇Python檔案│
│  (可多選)     │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  前端驗證     │
│  (.py格式檢查)│
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  上傳至後端   │
│  (Flask API) │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  儲存至uploads/│
│  目錄         │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  更新檔案列表 │
│  (顯示在介面) │
└──────────────┘
```

### 1.2 展示生成流程
```
┌──────────────┐
│  點擊「生成展示」│
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  後端讀取     │
│  uploads/目錄 │
│  所有.py檔案  │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  解析檔案內容 │
│  (讀取程式碼) │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  套用程式碼高亮│
│  (highlight.js)│
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  生成HTML結構 │
│  (模板渲染)   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  顯示在瀏覽器 │
│  (展示頁面)   │
└──────────────┘
```

## 二、系統架構圖

### 2.1 三層架構
```
┌─────────────────────────────────────────┐
│           展示層 (Presentation)          │
│  ┌──────────┐  ┌──────────┐            │
│  │上傳介面   │  │展示介面   │            │
│  │(index.html)│ │(display.html)│        │
│  └──────────┘  └──────────┘            │
│         │              │                │
└─────────┼──────────────┼────────────────┘
          │              │
          ▼              ▼
┌─────────────────────────────────────────┐
│           業務邏輯層 (Business Logic)    │
│  ┌──────────┐  ┌──────────┐            │
│  │檔案上傳API│  │展示生成API│            │
│  │/upload   │  │/display  │            │
│  └──────────┘  └──────────┘            │
│         │              │                │
└─────────┼──────────────┼────────────────┘
          │              │
          ▼              ▼
┌─────────────────────────────────────────┐
│           資料層 (Data Layer)            │
│  ┌──────────┐  ┌──────────┐            │
│  │檔案系統   │  │檔案解析   │            │
│  │uploads/  │  │Python解析 │            │
│  └──────────┘  └──────────┘            │
└─────────────────────────────────────────┘
```

### 2.2 資料流向
```
前端 (Browser)
    │
    │ HTTP Request (POST /upload)
    ▼
後端 (Flask)
    │
    │ 檔案驗證 & 儲存
    ▼
檔案系統 (uploads/)
    │
    │ 讀取檔案
    ▼
後端 (Flask)
    │
    │ 解析 & 高亮處理
    ▼
前端 (Browser)
    │
    │ HTML渲染
    ▼
展示頁面 (display.html)
```

## 三、功能模組關係圖

```
┌─────────────────────────────────────┐
│         程式展示系統                 │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────┐  ┌─────────────┐ │
│  │ 檔案上傳模組 │  │ 檔案管理模組 │ │
│  │             │──│             │ │
│  │ - 多檔上傳   │  │ - 列表顯示   │ │
│  │ - 拖放上傳   │  │ - 檔案刪除   │ │
│  │ - 格式驗證   │  │ - 檔案預覽   │ │
│  └─────────────┘  └─────────────┘ │
│         │                │         │
│         └────────┬───────┘         │
│                  ▼                 │
│         ┌─────────────┐            │
│         │ 展示生成模組 │            │
│         │             │            │
│         │ - 讀取檔案   │            │
│         │ - 程式碼高亮 │            │
│         │ - HTML生成   │            │
│         └─────────────┘            │
│                  │                 │
│                  ▼                 │
│         ┌─────────────┐            │
│         │ 程式碼展示模組│            │
│         │             │            │
│         │ - 高亮顯示   │            │
│         │ - 行號顯示   │            │
│         │ - 可折疊區塊 │            │
│         └─────────────┘            │
│                                     │
└─────────────────────────────────────┘
```

## 四、技術棧示意圖

```
┌─────────────────────────────────────┐
│           前端技術棧                 │
├─────────────────────────────────────┤
│  HTML5      │  結構標籤              │
│  CSS3       │  樣式設計              │
│  JavaScript │  互動邏輯              │
│  highlight.js│ 程式碼高亮            │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│           後端技術棧                 │
├─────────────────────────────────────┤
│  Python     │  主要語言              │
│  Flask      │  Web框架              │
│  os/sys     │  檔案系統操作          │
│  shutil     │  檔案工具              │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│           儲存技術棧                 │
├─────────────────────────────────────┤
│  檔案系統   │  uploads/ 目錄         │
│  (未來可擴展至資料庫)                │
└─────────────────────────────────────┘
```

## 五、使用者操作流程

```
開始
  │
  ▼
開啟系統首頁
  │
  ▼
┌─────────────────┐
│ 選擇操作：       │
│ 1. 上傳檔案      │
│ 2. 查看已上傳    │
│ 3. 生成展示      │
└─────┬───────────┘
      │
      ├─→ 上傳檔案 ──→ 驗證 ──→ 儲存 ──→ 更新列表
      │
      ├─→ 查看已上傳 ──→ 顯示檔案列表 ──→ 可刪除/預覽
      │
      └─→ 生成展示 ──→ 讀取所有檔案 ──→ 高亮處理 ──→ 顯示結果
                                                      │
                                                      ▼
                                                  結束/匯出
```

## 六、資料結構設計

### 6.1 檔案資訊結構
```javascript
{
  "filename": "student1.py",
  "size": 1024,           // 位元組
  "upload_time": "2024-01-01 12:00:00",
  "content": "def hello():\n    print('Hello')",
  "line_count": 2
}
```

### 6.2 展示頁面資料結構
```javascript
{
  "total_files": 10,
  "files": [
    {
      "filename": "student1.py",
      "content": "...",
      "highlighted_content": "<pre><code>...</code></pre>"
    },
    // ... 更多檔案
  ]
}
```

## 七、API端點設計（方案B）

```
POST   /upload          # 上傳檔案
GET    /files           # 獲取檔案列表
GET    /file/<filename> # 獲取單個檔案內容
DELETE /file/<filename> # 刪除檔案
GET    /display         # 生成展示頁面
GET    /export          # 匯出HTML
```

## 八、安全性流程

```
檔案上傳
  │
  ▼
┌──────────────┐
│ 檔案類型檢查  │  (.py only)
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 檔案大小檢查  │  (限制大小)
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 檔案名稱清理  │  (防止路徑遍歷)
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 儲存至安全目錄│  (uploads/)
└──────────────┘
```

---

**建議閱讀順序**：
1. 先看「系統設計建議.md」了解整體架構
2. 再看此文件了解流程細節
3. 根據需求選擇合適的方案開始開發
