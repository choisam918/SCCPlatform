<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>æ¯æ—¥å‹µå¿—å¡ç‰‡</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <a href="../index.html" class="back-btn">â† è¿”å›ä¸»ç³»çµ±</a>
    <button class="settings-btn" onclick="toggleSettings()" title="è¨­å®š">âš™ï¸</button>
    <a href="admin.html" class="admin-btn">ç®¡ç†è€…ç™»å…¥</a>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ“… æ¯æ—¥å‹µå¿—å¡ç‰‡</h1>
            <div class="date-display" id="date-display">è¼‰å…¥ä¸­...</div>
        </div>

        <!-- å¡ç‰‡å®¹å™¨ -->
        <div class="cards-container" id="cards-container">
            <div class="card" id="card-0">
                <!-- å¡ç‰‡èƒŒé¢ -->
                <div class="card-face card-back">
                    <div class="card-back-content">
                        <div class="card-back-icon">ğŸ´</div>
                        <div class="card-back-text">ç­‰å¾…æŠ½å¡</div>
                    </div>
                </div>
                <!-- å¡ç‰‡æ­£é¢ -->
                <div class="card-face card-front">
                    <div class="card-front-content">
                        <div class="card-category">é¼“å‹µ</div>
                        <div class="card-icon">âœ¨</div>
                        <div class="card-text">æº–å‚™å¥½æŠ½å¡äº†å—ï¼Ÿ</div>
                    </div>
                </div>
            </div>
            <div class="card" id="card-1">
                <!-- å¡ç‰‡èƒŒé¢ -->
                <div class="card-face card-back">
                    <div class="card-back-content">
                        <div class="card-back-icon">ğŸ´</div>
                        <div class="card-back-text">ç­‰å¾…æŠ½å¡</div>
                    </div>
                </div>
                <!-- å¡ç‰‡æ­£é¢ -->
                <div class="card-face card-front">
                    <div class="card-front-content">
                        <div class="card-category">é¼“å‹µ</div>
                        <div class="card-icon">âœ¨</div>
                        <div class="card-text">æº–å‚™å¥½æŠ½å¡äº†å—ï¼Ÿ</div>
                    </div>
                </div>
            </div>
            <div class="card" id="card-2">
                <!-- å¡ç‰‡èƒŒé¢ -->
                <div class="card-face card-back">
                    <div class="card-back-content">
                        <div class="card-back-icon">ğŸ´</div>
                        <div class="card-back-text">ç­‰å¾…æŠ½å¡</div>
                    </div>
                </div>
                <!-- å¡ç‰‡æ­£é¢ -->
                <div class="card-face card-front">
                    <div class="card-front-content">
                        <div class="card-category">é¼“å‹µ</div>
                        <div class="card-icon">âœ¨</div>
                        <div class="card-text">æº–å‚™å¥½æŠ½å¡äº†å—ï¼Ÿ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç‹€æ…‹è¨Šæ¯ -->
        <div class="status-message" id="status-message">
            é»æ“Šä¸‹æ–¹æŒ‰éˆ•æŠ½ä¸‰å¼µå‹µå¿—å¡ç‰‡
        </div>

        <!-- æŠ½å¡æŒ‰éˆ• -->
        <button class="btn" id="draw-btn" onclick="drawCard()" style="display: none;">
            æŠ½ä¸‰å¼µå¡ç‰‡
        </button>

    </div>

    <!-- è¨­å®šé¢æ¿ -->
    <div class="settings-modal" id="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h2>âš™ï¸ å€‹äººåŒ–è¨­å®š</h2>
                <button class="close-btn" onclick="toggleSettings()">Ã—</button>
            </div>
            
            <div class="settings-body">
                <!-- ä¸»é¡Œæ¨¡å¼ -->
                <div class="setting-section">
                    <label class="setting-label">ğŸŒ“ ä¸»é¡Œæ¨¡å¼</label>
                    <div class="theme-toggle-group">
                        <button class="theme-option active" data-theme="light" onclick="setTheme('light')">
                            <span class="theme-icon">â˜€ï¸</span>
                            <span>æ·ºè‰²</span>
                        </button>
                        <button class="theme-option" data-theme="dark" onclick="setTheme('dark')">
                            <span class="theme-icon">ğŸŒ™</span>
                            <span>æ·±è‰²</span>
                        </button>
                        <button class="theme-option" data-theme="auto" onclick="setTheme('auto')">
                            <span class="theme-icon">ğŸ”„</span>
                            <span>è‡ªå‹•</span>
                        </button>
                    </div>
                </div>

                <!-- å­—é«”å¤§å° -->
                <div class="setting-section">
                    <label class="setting-label">ğŸ“ å­—é«”å¤§å°</label>
                    <div class="font-size-control">
                        <button class="size-btn" onclick="adjustFontSize(-1)">A-</button>
                        <span class="font-size-display" id="font-size-display">ä¸­ç­‰</span>
                        <button class="size-btn" onclick="adjustFontSize(1)">A+</button>
                    </div>
                    <input type="range" id="font-size-slider" min="0" max="4" value="2" 
                           class="font-size-slider" oninput="setFontSize(parseInt(this.value))">
                </div>

                <!-- å¡ç‰‡æ¨£å¼ -->
                <div class="setting-section">
                    <label class="setting-label">ğŸ¨ å¡ç‰‡æ¨£å¼</label>
                    <div class="card-style-grid">
                        <div class="card-style-option active" data-style="default" onclick="setCardStyle('default')">
                            <div class="style-preview default-style"></div>
                            <span>ç¶“å…¸</span>
                        </div>
                        <div class="card-style-option" data-style="modern" onclick="setCardStyle('modern')">
                            <div class="style-preview modern-style"></div>
                            <span>ç¾ä»£</span>
                        </div>
                        <div class="card-style-option" data-style="minimal" onclick="setCardStyle('minimal')">
                            <div class="style-preview minimal-style"></div>
                            <span>æ¥µç°¡</span>
                        </div>
                        <div class="card-style-option" data-style="elegant" onclick="setCardStyle('elegant')">
                            <div class="style-preview elegant-style"></div>
                            <span>å„ªé›…</span>
                        </div>
                    </div>
                </div>

                <!-- å¡ç‰‡é¡è‰² -->
                <div class="setting-section">
                    <label class="setting-label">ğŸ¨ å¡ç‰‡ä¸»é¡Œè‰²</label>
                    <div class="color-presets">
                        <div class="color-preset" data-color="#667eea" onclick="setCardThemeColor('#667eea')" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
                        <div class="color-preset" data-color="#f093fb" onclick="setCardThemeColor('#f093fb')" style="background: linear-gradient(135deg, #f093fb, #f5576c);"></div>
                        <div class="color-preset" data-color="#4facfe" onclick="setCardThemeColor('#4facfe')" style="background: linear-gradient(135deg, #4facfe, #00f2fe);"></div>
                        <div class="color-preset" data-color="#43e97b" onclick="setCardThemeColor('#43e97b')" style="background: linear-gradient(135deg, #43e97b, #38f9d7);"></div>
                        <div class="color-preset" data-color="#fa709a" onclick="setCardThemeColor('#fa709a')" style="background: linear-gradient(135deg, #fa709a, #fee140);"></div>
                        <div class="color-preset" data-color="#30cfd0" onclick="setCardThemeColor('#30cfd0')" style="background: linear-gradient(135deg, #30cfd0, #330867);"></div>
                    </div>
                </div>

                <!-- é‡ç½®è¨­å®š -->
                <div class="setting-section">
                    <button class="btn-reset" onclick="resetSettings()">ğŸ”„ é‡ç½®ç‚ºé è¨­</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç«‹å³æ£€æŸ¥å¹¶åˆå§‹åŒ–æ•°æ®ï¼ˆåœ¨ä»»ä½•è„šæœ¬åŠ è½½å‰ï¼‰
        (function() {
            // æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰å®Œæ•´æ•°æ®
            try {
                const savedCards = localStorage.getItem('cardsData');
                if (savedCards) {
                    const parsed = JSON.parse(savedCards);
                    if (parsed.length >= 400) {
                        console.log('âœ… æ£€æµ‹åˆ° localStorage ä¸­æœ‰å®Œæ•´æ•°æ®ï¼ˆ' + parsed.length + 'æ¡ï¼‰');
                        return; // å·²æœ‰å®Œæ•´æ•°æ®ï¼Œä¸éœ€è¦åˆå§‹åŒ–
                    }
                }
            } catch (e) {
                console.warn('æ£€æŸ¥ localStorage å¤±è´¥:', e);
            }
            
            // å¦‚æœæ²¡æœ‰å®Œæ•´æ•°æ®ï¼Œå°è¯•ç«‹å³åˆå§‹åŒ–
            console.log('ğŸ”„ å‡†å¤‡åˆå§‹åŒ–æ•°æ®...');
        })();
    </script>
    <script src="js/card-system.js"></script>
    <script src="js/settings.js"></script>
    <script>
        // ç¡®ä¿æ•°æ®åˆå§‹åŒ–ï¼šåœ¨é¡µé¢åŠ è½½åæ£€æŸ¥å¹¶åˆå§‹åŒ–å®Œæ•´æ•°æ®
        window.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç­‰å¾… card-system.js åŠ è½½å®Œæˆ
            setTimeout(function() {
                checkAndInitializeData();
            }, 1000); // å¢åŠ å»¶è¿Ÿç¡®ä¿ cardSystem å®Œå…¨åˆå§‹åŒ–
        });

        async function checkAndInitializeData() {
            // æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰å®Œæ•´çš„400æ¡æ•°æ®
            const savedCards = localStorage.getItem('cardsData');
            let needsInit = false;
            
            if (!savedCards) {
                needsInit = true;
                console.log('ğŸ“­ localStorage ä¸­æ²¡æœ‰æ•°æ®ï¼Œéœ€è¦åˆå§‹åŒ–');
            } else {
                try {
                    const parsedCards = JSON.parse(savedCards);
                    if (parsedCards.length < 400) {
                        needsInit = true;
                        console.log('âš ï¸ localStorage ä¸­çš„æ•°æ®ä¸å®Œæ•´ï¼ˆ' + parsedCards.length + 'æ¡ï¼‰ï¼Œéœ€è¦é‡æ–°åŠ è½½');
                    } else {
                        console.log('âœ… localStorage ä¸­å·²æœ‰å®Œæ•´æ•°æ®ï¼ˆ' + parsedCards.length + 'æ¡ï¼‰');
                    }
                } catch (e) {
                    needsInit = true;
                    console.error('âŒ è§£æ localStorage æ•°æ®å¤±è´¥:', e);
                }
            }

            // å¦‚æœéœ€è¦åˆå§‹åŒ–ï¼Œå°è¯•ä» cards.json æ–‡ä»¶åŠ è½½
            if (needsInit) {
                console.log('ğŸ”„ æ­£åœ¨ä»æ–‡ä»¶åŠ è½½å®Œæ•´æ•°æ®...');
                let loaded = false;
                
                // æ–¹æ³•1: å°è¯•ä» cards.json æ–‡ä»¶åŠ è½½
                try {
                    const response = await fetch('./data/cards.json');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.length >= 400) {
                            localStorage.setItem('cardsData', JSON.stringify(data));
                            console.log('âœ… æˆåŠŸä»æ–‡ä»¶åŠ è½½å¹¶ä¿å­˜å®Œæ•´æ•°æ®ï¼ˆ' + data.length + 'æ¡ï¼‰');
                            loaded = true;
                        } else {
                            console.warn('âš ï¸ æ–‡ä»¶ä¸­çš„æ•°æ®ä¸å®Œæ•´ï¼ˆ' + data.length + 'æ¡ï¼‰');
                        }
                    }
                } catch (error) {
                    console.error('âŒ ä»æ–‡ä»¶åŠ è½½å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ CORS é—®é¢˜ï¼‰:', error);
                }
                
                // æ–¹æ³•2: å¦‚æœæ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œå°è¯•ä» admin.html æå–æ•°æ®
                if (!loaded) {
                    console.log('ğŸ”„ å°è¯•ä» admin.html æå–å®Œæ•´æ•°æ®...');
                    try {
                        const adminResponse = await fetch('./admin.html');
                        if (adminResponse.ok) {
                            const adminHtml = await adminResponse.text();
                            // æå– defaultCardsData
                            const match = adminHtml.match(/const defaultCardsData\s*=\s*(\[[\s\S]*?\])\s*;/);
                            if (match && match[1]) {
                                try {
                                    const fullData = JSON.parse(match[1]);
                                    if (fullData && Array.isArray(fullData) && fullData.length >= 400) {
                                        localStorage.setItem('cardsData', JSON.stringify(fullData));
                                        console.log('âœ… æˆåŠŸä» admin.html æå–å¹¶ä¿å­˜å®Œæ•´æ•°æ®ï¼ˆ' + fullData.length + 'æ¡ï¼‰');
                                        loaded = true;
                                    }
                                } catch (parseError) {
                                    console.error('è§£æä» admin.html æå–çš„ JSON å¤±è´¥:', parseError);
                                }
                            }
                        }
                    } catch (error) {
                        console.error('ä» admin.html è·å–æ•°æ®å¤±è´¥:', error);
                    }
                }
                
                // å¦‚æœæˆåŠŸåŠ è½½ï¼Œæ›´æ–°å¡ç‰‡ç³»ç»Ÿ
                if (loaded && window.cardSystem) {
                    await window.cardSystem.forceLoadCompleteData();
                    // æ›´æ–°çŠ¶æ€æ¶ˆæ¯
                    const statusMsg = document.getElementById('status-message');
                    if (statusMsg) {
                        statusMsg.textContent = 'é»æ“Šä¸‹æ–¹æŒ‰éˆ•æŠ½ä¸‰å¼µå‹µå¿—å¡ç‰‡';
                        statusMsg.style.color = '';
                    }
                } else if (!loaded) {
                    // å¦‚æœä¸¤ç§æ–¹æ³•éƒ½å¤±è´¥
                    console.error('âŒ æ— æ³•åŠ è½½å®Œæ•´æ•°æ®ï¼');
                    const statusMsg = document.getElementById('status-message');
                    if (statusMsg) {
                        statusMsg.textContent = 'æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’"ç®¡ç†è€…ç™»å…¥"åˆå§‹åŒ–æ•°æ®';
                        statusMsg.style.color = '#FF6B6B';
                    }
                }
            }
        }
    </script>
</body>
</html>



