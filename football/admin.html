<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶³çƒæˆ°è¡“ç³»çµ± - ç®¡ç†é é¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .admin-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .admin-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .admin-content {
            padding: 30px;
            max-height: 75vh;
            overflow-y: auto;
        }

        .admin-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #1e3c72;
        }

        .admin-section h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .admin-card h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .admin-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.3);
        }

        .admin-btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .admin-btn.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .admin-btn.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            color: #1e3c72;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table th {
            background: #1e3c72;
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #1e3c72;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        /* ç™»å…¥é é¢æ¨£å¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h1 {
            color: #1e3c72;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .login-box .form-group {
            margin-bottom: 25px;
        }

        .login-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .login-box input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .login-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.3);
        }

        .error-message {
            color: #dc3545;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ -->
    <div id="loginPage" class="login-container">
        <button class="back-btn" onclick="goBack()">â† è¿”å›ä¸»é </button>
        <div class="login-box">
            <h1>ğŸ” ç®¡ç†å“¡ç™»å…¥</h1>
            <div class="form-group">
                <label for="adminPassword">ç®¡ç†å“¡å¯†ç¢¼</label>
                <input type="password" id="adminPassword" placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼" onkeypress="handlePasswordKeyPress(event)">
            </div>
            <button class="login-btn" onclick="checkPassword()">ç™»å…¥</button>
            <div id="errorMessage" class="error-message hidden"></div>
        </div>
    </div>

    <!-- ç®¡ç†é é¢å…§å®¹ -->
    <div id="adminPage" class="hidden">
        <button class="back-btn" onclick="goBack()">â† è¿”å›ä¸»é </button>
        
        <div class="admin-container">
            <div class="admin-header">
                <h1>âš½ è¶³çƒæˆ°è¡“ç³»çµ±ç®¡ç†</h1>
                <p>ç³»çµ±ç®¡ç†èˆ‡æ•¸æ“šç¶­è­·</p>
            </div>
            
            <div class="admin-content">
            <!-- çµ±è¨ˆæ¦‚è¦½ -->
            <div class="admin-section">
                <h2>ğŸ“Š ç³»çµ±çµ±è¨ˆ</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalFormations">0</div>
                        <div class="stat-label">ä¿å­˜çš„é™£å‹</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalNotes">0</div>
                        <div class="stat-label">è³½äº‹ç­†è¨˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPlayers">30</div>
                        <div class="stat-label">çƒå“¡ç¸½æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lastBackup">-</div>
                        <div class="stat-label">æœ€å¾Œå‚™ä»½</div>
                    </div>
                </div>
            </div>

            <!-- æ•¸æ“šç®¡ç† -->
            <div class="admin-section">
                <h2>ğŸ—„ï¸ æ•¸æ“šç®¡ç†</h2>
                <div class="admin-grid">
                    <div class="admin-card">
                        <h3>é™£å‹ç®¡ç†</h3>
                        <p>ç®¡ç†ä¿å­˜çš„æˆ°è¡“é™£å‹è¨˜éŒ„</p>
                        <button class="admin-btn" onclick="viewFormations()">æŸ¥çœ‹é™£å‹</button>
                        <button class="admin-btn danger" onclick="clearAllFormations()">æ¸…ç©ºæ‰€æœ‰</button>
                    </div>
                    
                    <div class="admin-card">
                        <h3>ç­†è¨˜ç®¡ç†</h3>
                        <p>ç®¡ç†è³½äº‹ç­†è¨˜èˆ‡è¨˜éŒ„</p>
                        <button class="admin-btn" onclick="viewNotes()">æŸ¥çœ‹ç­†è¨˜</button>
                        <button class="admin-btn danger" onclick="clearAllNotes()">æ¸…ç©ºæ‰€æœ‰</button>
                    </div>
                    
                    <div class="admin-card">
                        <h3>æ•¸æ“šå‚™ä»½</h3>
                        <p>å‚™ä»½èˆ‡é‚„åŸé™£å‹ç­†è¨˜</p>
                        <button class="admin-btn success" onclick="backupData()">å‚™ä»½æ•¸æ“š</button>
                        <button class="admin-btn warning" onclick="restoreData()">é‚„åŸæ•¸æ“š</button>
                    </div>
                    
                    <div class="admin-card">
                        <h3>ç³»çµ±å‚™ä»½</h3>
                        <p>å®Œæ•´ç³»çµ±å‚™ä»½èˆ‡é‚„åŸ</p>
                        <button class="admin-btn success" onclick="backupSystem()">ç³»çµ±å‚™ä»½</button>
                        <button class="admin-btn warning" onclick="restoreSystem()">ç³»çµ±é‚„åŸ</button>
                        <button class="admin-btn" onclick="viewBackupHistory()">å‚™ä»½æ­·å²</button>
                        <button class="admin-btn" onclick="setupAutoBackup()">è‡ªå‹•å‚™ä»½è¨­å®š</button>
                    </div>
                    
                    <div class="admin-card">
                        <h3>ç³»çµ±é‡ç½®</h3>
                        <p>é‡ç½®ç³»çµ±åˆ°åˆå§‹ç‹€æ…‹</p>
                        <button class="admin-btn danger" onclick="resetSystem()">é‡ç½®ç³»çµ±</button>
                    </div>
                </div>
            </div>

            <!-- ç³»çµ±è¨­å®š -->
            <!-- æ­¤å€å¡Šå·²ç§»é™¤ -->
        </div>
    </div>

    <!-- é™£å‹åˆ—è¡¨æ¨¡æ…‹æ¡† -->
    <div id="formationsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('formationsModal')">&times;</span>
            <h3>ä¿å­˜çš„é™£å‹åˆ—è¡¨</h3>
            <div id="formationsList"></div>
        </div>
    </div>

    <!-- ç­†è¨˜åˆ—è¡¨æ¨¡æ…‹æ¡† -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('notesModal')">&times;</span>
            <h3>è³½äº‹ç­†è¨˜åˆ—è¡¨</h3>
            <div id="notesList"></div>
        </div>
    </div>

    <!-- å‚™ä»½æ­·å²æ¨¡æ…‹æ¡† -->
    <div id="backupHistoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('backupHistoryModal')">&times;</span>
            <h3>ç³»çµ±å‚™ä»½æ­·å²</h3>
            <div id="backupHistoryList"></div>
        </div>
    </div>

    <script>
        // ç®¡ç†å“¡å¯†ç¢¼
        const ADMIN_PASSWORD = 'admin@123';
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“ç™»å…¥
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                showAdminPage();
                checkBackupReminder(); // æª¢æŸ¥å‚™ä»½æé†’
            } else {
                showLoginPage();
            }
        });

        // æª¢æŸ¥å‚™ä»½æé†’
        function checkBackupReminder() {
            const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') === 'true';
            if (!autoBackupEnabled) return;
            
            const nextReminder = localStorage.getItem('nextBackupReminder');
            if (!nextReminder) return;
            
            const now = new Date();
            const reminderTime = new Date(nextReminder);
            
            if (now >= reminderTime) {
                // é¡¯ç¤ºå‚™ä»½æé†’
                if (confirm('ğŸ“… å‚™ä»½æé†’\n\nè·é›¢ä¸Šæ¬¡å‚™ä»½å·²ç¶“è¶…éè¨­å®šçš„æ™‚é–“ï¼Œå»ºè­°æ‚¨ç¾åœ¨é€²è¡Œæ•¸æ“šå‚™ä»½ã€‚\n\næ˜¯å¦è¦ç¾åœ¨é€²è¡Œç³»çµ±å‚™ä»½ï¼Ÿ')) {
                    backupSystem();
                } else {
                    // å»¶é²æé†’åˆ°æ˜å¤©
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    localStorage.setItem('nextBackupReminder', tomorrow.toISOString());
                }
            }
        }

        // é¡¯ç¤ºç™»å…¥é é¢
        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('adminPage').classList.add('hidden');
        }

        // é¡¯ç¤ºç®¡ç†é é¢
        function showAdminPage() {
            console.log('é¡¯ç¤ºç®¡ç†é é¢');
            const loginPage = document.getElementById('loginPage');
            const adminPage = document.getElementById('adminPage');
            
            console.log('ç™»å…¥é é¢å…ƒç´ :', loginPage);
            console.log('ç®¡ç†é é¢å…ƒç´ :', adminPage);
            
            if (loginPage) {
                loginPage.classList.add('hidden');
                console.log('éš±è—ç™»å…¥é é¢');
            }
            if (adminPage) {
                adminPage.classList.remove('hidden');
                console.log('é¡¯ç¤ºç®¡ç†é é¢');
            }
            
            updateStats();
        }

        // æª¢æŸ¥å¯†ç¢¼
        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            const errorMessage = document.getElementById('errorMessage');
            
            console.log('æª¢æŸ¥å¯†ç¢¼:', password);
            console.log('æ­£ç¢ºå¯†ç¢¼:', ADMIN_PASSWORD);
            
            if (password === ADMIN_PASSWORD) {
                // ç™»å…¥æˆåŠŸ
                console.log('å¯†ç¢¼æ­£ç¢ºï¼Œé¡¯ç¤ºç®¡ç†é é¢');
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdminPage();
                errorMessage.classList.add('hidden');
            } else {
                // ç™»å…¥å¤±æ•—
                console.log('å¯†ç¢¼éŒ¯èª¤');
                errorMessage.textContent = 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ï¼';
                errorMessage.classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        // è™•ç†å¯†ç¢¼è¼¸å…¥æ¡†çš„ Enter éµ
        function handlePasswordKeyPress(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            showLoginPage();
        }

        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            // é™£å‹æ•¸é‡
            const formations = JSON.parse(localStorage.getItem('footballFormations') || '[]');
            document.getElementById('totalFormations').textContent = formations.length;
            
            // ç­†è¨˜æ•¸é‡
            const notes = JSON.parse(localStorage.getItem('footballNotes') || '[]');
            document.getElementById('totalNotes').textContent = notes.length;
            
            // çƒå“¡æ•¸é‡ (å›ºå®š30äºº)
            document.getElementById('totalPlayers').textContent = '30';
            
            // æœ€å¾Œå‚™ä»½æ™‚é–“
            const lastBackup = localStorage.getItem('lastBackupTime');
            const lastSystemBackup = localStorage.getItem('lastSystemBackupTime');
            const backupTime = lastSystemBackup || lastBackup;
            document.getElementById('lastBackup').textContent = backupTime ? new Date(backupTime).toLocaleDateString() : 'ç„¡';
        }

        // è¿”å›ä¸»é 
        function goBack() {
            // ä½¿ç”¨ Electron IPC è¿”å›ä¸»é 
            if (window.electronAPI) {
                window.electronAPI.navigateToMain();
            } else {
                // å‚™ç”¨æ–¹æ¡ˆï¼šç›´æ¥å°èˆª
                window.location.href = 'index.html';
            }
        }

        // æŸ¥çœ‹é™£å‹
        function viewFormations() {
            const formations = JSON.parse(localStorage.getItem('footballFormations') || '[]');
            const modal = document.getElementById('formationsModal');
            const list = document.getElementById('formationsList');
            
            if (formations.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">æš«ç„¡ä¿å­˜çš„é™£å‹</p>';
            } else {
                let html = '<table class="data-table">';
                html += '<tr><th>é™£å‹åç¨±</th><th>ä¸»éšŠ</th><th>å®¢éšŠ</th><th>æ¯”åˆ†</th><th>ä¿å­˜æ™‚é–“</th><th>æ“ä½œ</th></tr>';
                
                formations.forEach((formation, index) => {
                    const date = new Date(formation.timestamp).toLocaleString();
                    html += `<tr>
                        <td>${formation.name}</td>
                        <td>${formation.homeTeamName || 'ä¸»éšŠ'}</td>
                        <td>${formation.awayTeamName || 'å®¢éšŠ'}</td>
                        <td>${formation.homeScore || 0} : ${formation.awayScore || 0}</td>
                        <td>${date}</td>
                        <td>
                            <button class="admin-btn" onclick="deleteFormation(${index})">åˆªé™¤</button>
                        </td>
                    </tr>`;
                });
                html += '</table>';
                list.innerHTML = html;
            }
            
            modal.style.display = 'block';
        }

        // æŸ¥çœ‹ç­†è¨˜
        function viewNotes() {
            const notes = JSON.parse(localStorage.getItem('footballNotes') || '[]');
            const modal = document.getElementById('notesModal');
            const list = document.getElementById('notesList');
            
            if (notes.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">æš«ç„¡è³½äº‹ç­†è¨˜</p>';
            } else {
                let html = '<table class="data-table">';
                html += '<tr><th>ç­†è¨˜å…§å®¹</th><th>æ™‚é–“</th><th>æ“ä½œ</th></tr>';
                
                notes.forEach((note, index) => {
                    const date = new Date(note.timestamp).toLocaleString();
                    html += `<tr>
                        <td>${note.content.substring(0, 50)}${note.content.length > 50 ? '...' : ''}</td>
                        <td>${date}</td>
                        <td>
                            <button class="admin-btn" onclick="deleteNote(${index})">åˆªé™¤</button>
                        </td>
                    </tr>`;
                });
                html += '</table>';
                list.innerHTML = html;
            }
            
            modal.style.display = 'block';
        }

        // æ¸…ç©ºæ‰€æœ‰é™£å‹
        function clearAllFormations() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ä¿å­˜çš„é™£å‹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                localStorage.removeItem('footballFormations');
                updateStats();
                alert('æ‰€æœ‰é™£å‹å·²æ¸…ç©ºï¼');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰ç­†è¨˜
        function clearAllNotes() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³½äº‹ç­†è¨˜å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                localStorage.removeItem('footballNotes');
                updateStats();
                alert('æ‰€æœ‰ç­†è¨˜å·²æ¸…ç©ºï¼');
            }
        }

        // å‚™ä»½æ•¸æ“š
        function backupData() {
            const backup = {
                formations: JSON.parse(localStorage.getItem('footballFormations') || '[]'),
                notes: JSON.parse(localStorage.getItem('footballNotes') || '[]'),
                timestamp: new Date().toISOString()
            };
            
            // æª¢æ¸¬è¨­å‚™é¡å‹
            const isMobile = /Android|iPad|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isHuawei = /Huawei|HONOR/i.test(navigator.userAgent);
            
            if (isMobile) {
                // ç§»å‹•è¨­å‚™ï¼šä½¿ç”¨å¤šç¨®ä¿å­˜æ–¹å¼
                showMobileBackupOptions(backup, 'æ•¸æ“šå‚™ä»½');
            } else {
                // æ¡Œé¢è¨­å‚™ï¼šæ­£å¸¸ä¸‹è¼‰
                const blob = new Blob([JSON.stringify(backup, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `football_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                localStorage.setItem('lastBackupTime', new Date().toISOString());
                updateStats();
                
                alert('æ•¸æ“šå‚™ä»½å®Œæˆï¼\n\nğŸ“ æ–‡ä»¶å·²ä¿å­˜åˆ°æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾\nğŸ“„ æ–‡ä»¶åï¼šfootball_backup_' + new Date().toISOString().split('T')[0] + '.json\n\nğŸ’¡ å»ºè­°ï¼š\nâ€¢ å°‡å‚™ä»½æ–‡ä»¶ä¿å­˜åˆ°å®‰å…¨ä½ç½®\nâ€¢ å®šæœŸé€²è¡Œå‚™ä»½\nâ€¢ å¯ä»¥å°‡æ–‡ä»¶è¤‡è£½åˆ°é›²ç«¯ç¡¬ç¢Ÿ');
            }
        }

        // é‚„åŸæ•¸æ“š
        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const backup = JSON.parse(e.target.result);
                            if (backup.formations) {
                                localStorage.setItem('footballFormations', JSON.stringify(backup.formations));
                            }
                            if (backup.notes) {
                                localStorage.setItem('footballNotes', JSON.stringify(backup.notes));
                            }
                            updateStats();
                            alert('æ•¸æ“šé‚„åŸæˆåŠŸï¼');
                        } catch (error) {
                            alert('é‚„åŸå¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // ç³»çµ±å‚™ä»½
        function backupSystem() {
            // æ”¶é›†æ‰€æœ‰ç³»çµ±æ•¸æ“š
            const systemBackup = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                description: 'è¶³çƒæˆ°è¡“ç³»çµ±å®Œæ•´å‚™ä»½',
                
                // æ ¸å¿ƒæ•¸æ“š
                formations: JSON.parse(localStorage.getItem('footballFormations') || '[]'),
                notes: JSON.parse(localStorage.getItem('footballNotes') || '[]'),
                
                // ç³»çµ±è¨­å®š
                systemSettings: {
                    lastBackupTime: localStorage.getItem('lastBackupTime'),
                    adminLoginTime: sessionStorage.getItem('adminLoggedIn'),
                    // å¯ä»¥æ·»åŠ æ›´å¤šç³»çµ±è¨­å®š
                },
                
                // çµ±è¨ˆä¿¡æ¯
                statistics: {
                    totalFormations: JSON.parse(localStorage.getItem('footballFormations') || '[]').length,
                    totalNotes: JSON.parse(localStorage.getItem('footballNotes') || '[]').length,
                    totalPlayers: 30,
                    backupCreatedAt: new Date().toISOString()
                },
                
                // ç³»çµ±ä¿¡æ¯
                systemInfo: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine
                }
            };
            
            // æª¢æ¸¬è¨­å‚™é¡å‹
            const isMobile = /Android|iPad|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isHuawei = /Huawei|HONOR/i.test(navigator.userAgent);
            
            if (isMobile) {
                // ç§»å‹•è¨­å‚™ï¼šä½¿ç”¨å¤šç¨®ä¿å­˜æ–¹å¼
                showMobileBackupOptions(systemBackup, 'ç³»çµ±å‚™ä»½');
            } else {
                // æ¡Œé¢è¨­å‚™ï¼šæ­£å¸¸ä¸‹è¼‰
                const blob = new Blob([JSON.stringify(systemBackup, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `football_system_backup_${new Date().toISOString().split('T')[0]}_${new Date().toISOString().split('T')[1].split('.')[0].replace(/:/g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // æ›´æ–°å‚™ä»½æ™‚é–“
                localStorage.setItem('lastBackupTime', new Date().toISOString());
                localStorage.setItem('lastSystemBackupTime', new Date().toISOString());
                updateStats();
                
                // é¡¯ç¤ºè©³ç´°çš„ä¿å­˜èªªæ˜
                const fileName = `football_system_backup_${new Date().toISOString().split('T')[0]}_${new Date().toISOString().split('T')[1].split('.')[0].replace(/:/g, '-')}.json`;
                alert('ç³»çµ±å‚™ä»½å®Œæˆï¼\n\nğŸ“ æ–‡ä»¶å·²ä¿å­˜åˆ°æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾\nğŸ“„ æ–‡ä»¶åï¼š' + fileName + '\n\nğŸ“‹ å‚™ä»½å…§å®¹åŒ…æ‹¬ï¼š\nâ€¢ æ‰€æœ‰é™£å‹æ•¸æ“š\nâ€¢ æ‰€æœ‰è³½äº‹ç­†è¨˜\nâ€¢ ç³»çµ±è¨­å®š\nâ€¢ çµ±è¨ˆä¿¡æ¯\nâ€¢ ç³»çµ±ç’°å¢ƒä¿¡æ¯\n\nğŸ’¡ å»ºè­°ï¼š\nâ€¢ å°‡å‚™ä»½æ–‡ä»¶ä¿å­˜åˆ°å®‰å…¨ä½ç½®\nâ€¢ å®šæœŸé€²è¡Œç³»çµ±å‚™ä»½\nâ€¢ å¯ä»¥å°‡æ–‡ä»¶è¤‡è£½åˆ°é›²ç«¯ç¡¬ç¢Ÿ\nâ€¢ å»ºè­°æ¯é€±è‡³å°‘å‚™ä»½ä¸€æ¬¡');
            }
        }

        // ç³»çµ±é‚„åŸ
        function restoreSystem() {
            if (confirm('ç³»çµ±é‚„åŸå°‡è¦†è“‹æ‰€æœ‰ç¾æœ‰æ•¸æ“šï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const systemBackup = JSON.parse(e.target.result);
                                
                                // é©—è­‰å‚™ä»½æ–‡ä»¶æ ¼å¼
                                if (!systemBackup.version || !systemBackup.formations || !systemBackup.notes) {
                                    alert('é‚„åŸå¤±æ•—ï¼šä¸æ˜¯æœ‰æ•ˆçš„ç³»çµ±å‚™ä»½æ–‡ä»¶ï¼');
                                    return;
                                }
                                
                                // é‚„åŸæ ¸å¿ƒæ•¸æ“š
                                if (systemBackup.formations) {
                                    localStorage.setItem('footballFormations', JSON.stringify(systemBackup.formations));
                                }
                                if (systemBackup.notes) {
                                    localStorage.setItem('footballNotes', JSON.stringify(systemBackup.notes));
                                }
                                
                                // é‚„åŸç³»çµ±è¨­å®š
                                if (systemBackup.systemSettings) {
                                    if (systemBackup.systemSettings.lastBackupTime) {
                                        localStorage.setItem('lastBackupTime', systemBackup.systemSettings.lastBackupTime);
                                    }
                                }
                                
                                // æ›´æ–°çµ±è¨ˆ
                                updateStats();
                                
                                // é¡¯ç¤ºé‚„åŸä¿¡æ¯
                                let restoreInfo = 'ç³»çµ±é‚„åŸæˆåŠŸï¼\n\n';
                                restoreInfo += `å‚™ä»½ç‰ˆæœ¬ï¼š${systemBackup.version}\n`;
                                restoreInfo += `å‚™ä»½æ™‚é–“ï¼š${new Date(systemBackup.timestamp).toLocaleString()}\n`;
                                restoreInfo += `é™£å‹æ•¸é‡ï¼š${systemBackup.formations.length}\n`;
                                restoreInfo += `ç­†è¨˜æ•¸é‡ï¼š${systemBackup.notes.length}\n`;
                                
                                alert(restoreInfo);
                                
                            } catch (error) {
                                console.error('é‚„åŸéŒ¯èª¤:', error);
                                alert('é‚„åŸå¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤æˆ–æå£ï¼');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            }
        }

        // é‡ç½®ç³»çµ±
        function resetSystem() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ•´å€‹ç³»çµ±å—ï¼Ÿæ‰€æœ‰æ•¸æ“šå°‡è¢«æ¸…ç©ºï¼Œæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                if (confirm('æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦é‡ç½®ç³»çµ±å—ï¼Ÿ')) {
                    localStorage.clear();
                    updateStats();
                    alert('ç³»çµ±å·²é‡ç½®ï¼');
                    // é‡ç½®å¾Œè‡ªå‹•ç™»å‡ºä¸¦å›åˆ°ä¸»ç•«é¢
                    sessionStorage.removeItem('adminLoggedIn');
                    showLoginPage();
                }
            }
        }

        // åˆªé™¤é™£å‹
        function deleteFormation(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹é™£å‹å—ï¼Ÿ')) {
                const formations = JSON.parse(localStorage.getItem('footballFormations') || '[]');
                formations.splice(index, 1);
                localStorage.setItem('footballFormations', JSON.stringify(formations));
                viewFormations(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
                updateStats();
            }
        }

        // åˆªé™¤ç­†è¨˜
        function deleteNote(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç­†è¨˜å—ï¼Ÿ')) {
                const notes = JSON.parse(localStorage.getItem('footballNotes') || '[]');
                notes.splice(index, 1);
                localStorage.setItem('footballNotes', JSON.stringify(notes));
                viewNotes(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
                updateStats();
            }
        }

        // é—œé–‰æ¨¡æ…‹æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // æŸ¥çœ‹å‚™ä»½æ­·å²
        function viewBackupHistory() {
            const modal = document.getElementById('backupHistoryModal');
            const list = document.getElementById('backupHistoryList');
            
            const lastBackup = localStorage.getItem('lastBackupTime');
            const lastSystemBackup = localStorage.getItem('lastSystemBackupTime');
            
            let html = '<div style="margin-bottom: 20px;">';
            html += '<h4 style="color: #1e3c72; margin-bottom: 10px;">å‚™ä»½è¨˜éŒ„</h4>';
            
            if (lastSystemBackup) {
                const systemBackupDate = new Date(lastSystemBackup);
                html += `<div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <strong>ğŸ”„ ç³»çµ±å‚™ä»½</strong><br>
                    æ™‚é–“ï¼š${systemBackupDate.toLocaleString()}<br>
                    é¡å‹ï¼šå®Œæ•´ç³»çµ±å‚™ä»½
                </div>`;
            }
            
            if (lastBackup) {
                const backupDate = new Date(lastBackup);
                html += `<div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <strong>ğŸ“Š æ•¸æ“šå‚™ä»½</strong><br>
                    æ™‚é–“ï¼š${backupDate.toLocaleString()}<br>
                    é¡å‹ï¼šé™£å‹èˆ‡ç­†è¨˜å‚™ä»½
                </div>`;
            }
            
            if (!lastBackup && !lastSystemBackup) {
                html += '<div style="text-align: center; color: #6c757d; padding: 20px;">æš«ç„¡å‚™ä»½è¨˜éŒ„</div>';
            }
            
            html += '</div>';
            
            // æ·»åŠ å‚™ä»½çµ±è¨ˆ
            const formations = JSON.parse(localStorage.getItem('footballFormations') || '[]');
            const notes = JSON.parse(localStorage.getItem('footballNotes') || '[]');
            
            html += '<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">';
            html += '<h4 style="color: #1e3c72; margin-bottom: 10px;">ç•¶å‰æ•¸æ“šçµ±è¨ˆ</h4>';
            html += `<p>é™£å‹æ•¸é‡ï¼š${formations.length}</p>`;
            html += `<p>ç­†è¨˜æ•¸é‡ï¼š${notes.length}</p>`;
            html += `<p>çƒå“¡ç¸½æ•¸ï¼š30</p>`;
            html += '</div>';
            
            list.innerHTML = html;
            modal.style.display = 'block';
        }

        // è‡ªå‹•å‚™ä»½è¨­å®š
        function setupAutoBackup() {
            const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') === 'true';
            const autoBackupInterval = localStorage.getItem('autoBackupInterval') || '7'; // é è¨­7å¤©
            
            let html = '<div style="margin-bottom: 20px;">';
            html += '<h4 style="color: #1e3c72; margin-bottom: 15px;">è‡ªå‹•å‚™ä»½è¨­å®š</h4>';
            
            html += '<div style="margin-bottom: 15px;">';
            html += '<label style="display: flex; align-items: center; margin-bottom: 10px;">';
            html += `<input type="checkbox" id="autoBackupCheckbox" ${autoBackupEnabled ? 'checked' : ''} style="margin-right: 10px;">`;
            html += 'å•Ÿç”¨è‡ªå‹•å‚™ä»½æé†’';
            html += '</label>';
            html += '</div>';
            
            html += '<div style="margin-bottom: 15px;">';
            html += '<label style="display: block; margin-bottom: 5px;">å‚™ä»½æé†’é–“éš”ï¼š</label>';
            html += '<select id="backupInterval" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">';
            html += `<option value="1" ${autoBackupInterval === '1' ? 'selected' : ''}>æ¯å¤©</option>`;
            html += `<option value="3" ${autoBackupInterval === '3' ? 'selected' : ''}>æ¯3å¤©</option>`;
            html += `<option value="7" ${autoBackupInterval === '7' ? 'selected' : ''}>æ¯é€±</option>`;
            html += `<option value="14" ${autoBackupInterval === '14' ? 'selected' : ''}>æ¯2é€±</option>`;
            html += `<option value="30" ${autoBackupInterval === '30' ? 'selected' : ''}>æ¯æœˆ</option>`;
            html += '</select>';
            html += '</div>';
            
            html += '<div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
            html += '<strong>ğŸ’¡ è‡ªå‹•å‚™ä»½èªªæ˜ï¼š</strong><br>';
            html += 'â€¢ ç³»çµ±æœƒåœ¨æŒ‡å®šé–“éš”å¾Œæé†’æ‚¨é€²è¡Œå‚™ä»½<br>';
            html += 'â€¢ å‚™ä»½æ–‡ä»¶æœƒè‡ªå‹•ä¸‹è¼‰åˆ°æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾<br>';
            html += 'â€¢ å»ºè­°å®šæœŸå‚™ä»½ä»¥ä¿è­·é‡è¦æ•¸æ“š<br>';
            html += 'â€¢ å¯ä»¥æ‰‹å‹•é—œé–‰è‡ªå‹•å‚™ä»½åŠŸèƒ½';
            html += '</div>';
            
            html += '<div style="text-align: center;">';
            html += '<button class="admin-btn success" onclick="saveAutoBackupSettings()">ä¿å­˜è¨­å®š</button>';
            html += '<button class="admin-btn" onclick="closeModal(\'autoBackupModal\')" style="margin-left: 10px;">å–æ¶ˆ</button>';
            html += '</div>';
            
            // å‰µå»ºæˆ–æ›´æ–°æ¨¡æ…‹æ¡†
            let modal = document.getElementById('autoBackupModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'autoBackupModal';
                modal.className = 'modal';
                modal.style.cssText = `
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                `;
                
                const modalContent = document.createElement('div');
                modalContent.className = 'modal-content';
                modalContent.innerHTML = html;
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
            } else {
                modal.querySelector('.modal-content').innerHTML = html;
            }
            
            modal.style.display = 'block';
        }

        // ä¿å­˜è‡ªå‹•å‚™ä»½è¨­å®š
        function saveAutoBackupSettings() {
            const enabled = document.getElementById('autoBackupCheckbox').checked;
            const interval = document.getElementById('backupInterval').value;
            
            localStorage.setItem('autoBackupEnabled', enabled);
            localStorage.setItem('autoBackupInterval', interval);
            
            if (enabled) {
                // è¨­ç½®ä¸‹æ¬¡æé†’æ™‚é–“
                const nextReminder = new Date();
                nextReminder.setDate(nextReminder.getDate() + parseInt(interval));
                localStorage.setItem('nextBackupReminder', nextReminder.toISOString());
            } else {
                localStorage.removeItem('nextBackupReminder');
            }
            
            closeModal('autoBackupModal');
            alert('è‡ªå‹•å‚™ä»½è¨­å®šå·²ä¿å­˜ï¼');
        }

        // é¡¯ç¤ºç§»å‹•è¨­å‚™å‚™ä»½é¸é …
        function showMobileBackupOptions(backupData, backupType) {
            // ç§»é™¤å·²å­˜åœ¨çš„æ¨¡æ…‹æ¡†
            const existingModal = document.getElementById('mobileBackupModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // å‰µå»ºæ¨¡æ…‹æ¡†
            const modal = document.createElement('div');
            modal.id = 'mobileBackupModal';
            modal.className = 'modal';
            modal.style.cssText = `
                display: block;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100vw;
                height: 100vh;
                background-color: rgba(0,0,0,0.5);
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background-color: white;
                margin: 5vh auto;
                padding: 0;
                border-radius: 15px;
                width: 95vw;
                max-width: 420px;
                max-height: 90vh;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                display: flex;
                flex-direction: column;
                overflow: hidden;
            `;
            
            // æ¨™é¡Œ
            const title = document.createElement('h3');
            title.textContent = 'é¸æ“‡ä¿å­˜æ–¹å¼';
            title.style.cssText = `
                margin: 0;
                padding: 18px 18px 12px 18px;
                color: #1e3c72;
                text-align: center;
                font-size: 1.3rem;
                background: white;
                position: sticky;
                top: 0;
                z-index: 2;
            `;
            // æ–°å¢æ˜é¡¯æç¤º
            const shareTip = document.createElement('div');
            shareTip.textContent = 'å»ºè­°ä½¿ç”¨ã€Œåˆ†äº«ã€åŠŸèƒ½å°‡å‚™ä»½å°å‡ºåˆ°éƒµä»¶ã€é›²ç«¯ã€å¾®ä¿¡ç­‰æ”¯æ´çš„ Appã€‚';
            shareTip.style.cssText = `
                color: #155724;
                background: #d4edda;
                border-left: 4px solid #28a745;
                padding: 10px 18px;
                margin: 0 0 8px 0;
                font-size: 1rem;
                text-align: center;
            `;
            
            // ä¿å­˜é¸é …å®¹å™¨
            const optionsContainer = document.createElement('div');
            optionsContainer.style.cssText = `
                flex: 1 1 auto;
                overflow-y: auto;
                padding: 0 18px 0 18px;
                margin-bottom: 0;
                min-height: 0;
            `;
            
            // å‰µå»ºå‚™ä»½æ–‡ä»¶
            const fileName = backupType === 'ç³»çµ±å‚™ä»½' ? 
                `football_system_backup_${new Date().toISOString().split('T')[0]}_${new Date().toISOString().split('T')[1].split('.')[0].replace(/:/g, '-')}.json` :
                `football_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], {type: 'application/json'});
            
            // æ–°å¢å¯æ‰‹å‹•è¤‡è£½çš„å‚™ä»½å…§å®¹å€å¡Š
            const backupTextArea = document.createElement('textarea');
            backupTextArea.value = JSON.stringify(backupData, null, 2);
            backupTextArea.readOnly = true;
            backupTextArea.style.width = '100%';
            backupTextArea.style.height = '180px';
            backupTextArea.style.margin = '12px 0';
            backupTextArea.style.fontSize = '0.95rem';
            backupTextArea.style.fontFamily = 'monospace';
            backupTextArea.style.background = '#f8f9fa';
            backupTextArea.style.border = '1.5px solid #ffc107';
            backupTextArea.style.borderRadius = '8px';
            backupTextArea.style.padding = '10px';
            backupTextArea.style.overflowY = 'auto';
            backupTextArea.title = 'é•·æŒ‰å¯å…¨é¸ä¸¦è¤‡è£½';
            // æ’å…¥åˆ°é¸é …æœ€ä¸Šæ–¹
            optionsContainer.insertBefore(backupTextArea, optionsContainer.firstChild);
            
            // é¸é …1: è¤‡è£½åˆ°å‰ªè²¼ç°¿
            const clipboardOption = createMobileBackupOption(
                'ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿',
                'è¤‡è£½å‚™ä»½æ•¸æ“šåˆ°å‰ªè²¼ç°¿ï¼Œå¯è²¼åˆ°ç­†è¨˜æ‡‰ç”¨',
                () => copyBackupToClipboard(backupData)
            );
            
            // é¸é …2: åˆ†äº«åˆ°æª”æ¡ˆæ‡‰ç”¨
            const shareOption = createMobileBackupOption(
                'ğŸ“ åˆ†äº«åˆ°æª”æ¡ˆæ‡‰ç”¨',
                'å°‡å‚™ä»½åˆ†äº«åˆ°æª”æ¡ˆç®¡ç†å™¨ã€é›²ç«¯ç¡¬ç¢Ÿæˆ–å…¶ä»–æ‡‰ç”¨',
                () => shareBackupToFileApp(backupData, blob, fileName)
            );
            
            // é¸é …3: ä½¿ç”¨ç€è¦½å™¨ä¸‹è¼‰
            const downloadOption = createMobileBackupOption(
                'â¬‡ï¸ ç€è¦½å™¨ä¸‹è¼‰',
                'å˜—è©¦ä½¿ç”¨ç€è¦½å™¨ä¸‹è¼‰åŠŸèƒ½',
                () => tryMobileDownload(blob, fileName)
            );
            
            // é¸é …4: ä¿å­˜åˆ°è¯ç‚ºé›²ç«¯ç¡¬ç¢Ÿ
            const huaweiCloudOption = createMobileBackupOption(
                'â˜ï¸ ä¿å­˜åˆ°è¯ç‚ºé›²ç«¯ç¡¬ç¢Ÿ',
                'å°‡å‚™ä»½ä¿å­˜åˆ°è¯ç‚ºé›²ç«¯ç¡¬ç¢Ÿï¼ˆéœ€è¦å®‰è£è¯ç‚ºé›²ç«¯ç¡¬ç¢Ÿæ‡‰ç”¨ï¼‰',
                () => saveToHuaweiCloud(backupData, fileName)
            );
            
            // å–æ¶ˆæŒ‰éˆ•
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'å–æ¶ˆ';
            cancelBtn.style.cssText = `
                background: #6c757d;
                color: white;
                border: none;
                padding: 16px 0;
                border-radius: 0 0 15px 15px;
                cursor: pointer;
                font-size: 1.1rem;
                width: 100%;
                margin: 0;
                border-top: 1px solid #eee;
                position: sticky;
                bottom: 0;
                left: 0;
                z-index: 2;
            `;
            
            cancelBtn.addEventListener('click', () => {
                modal.remove();
            });
            
            // çµ„è£æ¨¡æ…‹æ¡†
            optionsContainer.appendChild(shareOption);
            optionsContainer.appendChild(clipboardOption);
            // optionsContainer.appendChild(downloadOption); // å·²ç§»é™¤
            // optionsContainer.appendChild(huaweiCloudOption); // å·²ç§»é™¤
            
            modalContent.appendChild(title);
            modalContent.appendChild(shareTip);
            modalContent.appendChild(optionsContainer);
            modalContent.appendChild(cancelBtn);
            modal.appendChild(modalContent);
            
            // é»æ“ŠèƒŒæ™¯é—œé–‰
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // æ·»åŠ åˆ°é é¢
            document.body.appendChild(modal);
        }

        // å‰µå»ºç§»å‹•è¨­å‚™å‚™ä»½é¸é …
        function createMobileBackupOption(title, description, onClick) {
            const option = document.createElement('div');
            option.style.cssText = `
                padding: 15px;
                border: 2px solid #e9ecef;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.3s ease;
                background: #f8f9fa;
                margin-bottom: 10px;
            `;
            
            option.innerHTML = `
                <div style="font-weight: bold; color: #1e3c72; margin-bottom: 5px;">
                    ${title}
                </div>
                <div style="font-size: 0.9rem; color: #6c757d;">
                    ${description}
                </div>
            `;
            
            // é»æ“Šäº‹ä»¶
            option.addEventListener('click', () => {
                onClick();
                document.getElementById('mobileBackupModal').remove();
            });
            
            // æ‡¸åœæ•ˆæœ
            option.addEventListener('mouseenter', () => {
                option.style.borderColor = '#1e3c72';
                option.style.background = '#e3f2fd';
            });
            
            option.addEventListener('mouseleave', () => {
                option.style.borderColor = '#e9ecef';
                option.style.background = '#f8f9fa';
            });
            
            return option;
        }

        // åˆ†äº«å‚™ä»½åˆ°æª”æ¡ˆæ‡‰ç”¨
        function shareBackupToFileApp(backupData, blob, fileName) {
            if (navigator.share) {
                const backupFile = new File([blob], fileName, {type: 'application/json'});
                navigator.share({
                    title: 'è¶³çƒæˆ°è¡“ç³»çµ±å‚™ä»½',
                    text: 'è¶³çƒæˆ°è¡“ç³»çµ±æ•¸æ“šå‚™ä»½æ–‡ä»¶',
                    files: [backupFile]
                }).then(() => {
                    localStorage.setItem('lastBackupTime', new Date().toISOString());
                    updateStats();
                    alert('å‚™ä»½åˆ†äº«æˆåŠŸï¼è«‹é¸æ“‡ä¿å­˜ä½ç½®ã€‚');
                }).catch(err => {
                    console.log('åˆ†äº«å¤±æ•—:', err);
                    alert('æœ¬è¨­å‚™ä¸æ”¯æ´åˆ†äº«åŠŸèƒ½ï¼Œè«‹æ”¹ç”¨ä¸‹è¼‰æˆ–è¤‡è£½ç­‰å…¶ä»–ä¿å­˜æ–¹å¼ã€‚');
                });
            } else {
                alert('æœ¬è¨­å‚™ä¸æ”¯æ´åˆ†äº«åŠŸèƒ½ï¼Œè«‹æ”¹ç”¨ä¸‹è¼‰æˆ–è¤‡è£½ç­‰å…¶ä»–ä¿å­˜æ–¹å¼ã€‚');
            }
        }

        // è¤‡è£½å‚™ä»½åˆ°å‰ªè²¼ç°¿
        function copyBackupToClipboard(backupData) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(JSON.stringify(backupData, null, 2)).then(() => {
                    localStorage.setItem('lastBackupTime', new Date().toISOString());
                    updateStats();
                    alert('âœ… å‚™ä»½æ•¸æ“šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\n\nğŸ“ æ‰‹å‹•ä¿å­˜æ­¥é©Ÿï¼š\n1. æ‰“é–‹è¨˜äº‹æœ¬æˆ–æª”æ¡ˆç®¡ç†å™¨\n2. å»ºç«‹æ–°æª”æ¡ˆ\n3. è²¼ä¸Šå‚™ä»½å…§å®¹\n4. å„²å­˜ç‚º .json æª”æ¡ˆ\n5. å»ºè­°æª”åï¼šfootball_backup_æ—¥æœŸ.json\n\nğŸ’¡ æç¤ºï¼šé‚„åŸæ™‚é¸æ“‡é€™å€‹ .json æª”æ¡ˆå³å¯');
                }).catch(err => {
                    console.error('è¤‡è£½å¤±æ•—:', err);
                    alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹æ•¸æ“šï¼š\n\n' + JSON.stringify(backupData, null, 2));
                });
            } else {
                alert('âŒ æ‚¨çš„è¨­å‚™ä¸æ”¯æ´å‰ªè²¼ç°¿åŠŸèƒ½ï¼Œè«‹ä½¿ç”¨å…¶ä»–ä¿å­˜æ–¹å¼ã€‚');
            }
        }

        // å˜—è©¦ç§»å‹•è¨­å‚™ä¸‹è¼‰
        function tryMobileDownload(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            updateStats();
            alert('å·²å˜—è©¦ä¸‹è¼‰å‚™ä»½æ–‡ä»¶ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾ã€‚');
        }

        // ä¿å­˜åˆ°è¯ç‚ºé›²ç«¯ç¡¬ç¢ŸåŠŸèƒ½
        function saveToHuaweiCloud(backupData, fileName) {
            const blob = new Blob([JSON.stringify(backupData, null, 2)], {type: 'application/json'});
            
            if (navigator.share) {
                const backupFile = new File([blob], fileName, {type: 'application/json'});
                navigator.share({
                    title: 'è¶³çƒæˆ°è¡“ç³»çµ±å‚™ä»½',
                    text: 'è«‹é¸æ“‡ä¿å­˜åˆ°è¯ç‚ºé›²ç«¯ç¡¬ç¢Ÿ',
                    files: [backupFile]
                }).then(() => {
                    localStorage.setItem('lastBackupTime', new Date().toISOString());
                    updateStats();
                    alert('å‚™ä»½æ–‡ä»¶å·²æº–å‚™å¥½ï¼è«‹åœ¨åˆ†äº«é¸é …ä¸­é¸æ“‡ã€Œè¯ç‚ºé›²ç«¯ç¡¬ç¢Ÿã€é€²è¡Œä¿å­˜ã€‚');
                }).catch(err => {
                    // å‚™ç”¨æ–¹æ¡ˆï¼šä¸‹è¼‰æ–‡ä»¶
                    tryMobileDownload(blob, fileName);
                });
            }
        }

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>