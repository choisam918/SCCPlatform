<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½ç™¼éŸ³ç·´ç¿’</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="../index.html" class="back-to-main-btn" title="è¿”å›ä¸»ç³»çµ±">â† è¿”å›ä¸»ç³»çµ±</a>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ è½ç™¼éŸ³ç·´ç¿’</h1>
            <p>è«‹è½è‹±æ–‡ç™¼éŸ³ï¼Œè¼¸å…¥æ­£ç¢ºçš„è‹±æ–‡å–®å­—</p>
        </div>
        
        <div id="practiceContent" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
            <!-- å…§å®¹å°‡ç”± JavaScript è‡ªå‹•è¼‰å…¥ -->
        </div>
        
        <div style="text-align: center; margin-top: 8px; flex-shrink: 0;">
            <button class="btn btn-secondary" onclick="window.location.href='index.html'" style="padding: 8px 20px; font-size: 0.85rem;">å›é¦–é </button>
        </div>
    </div>

    <script src="js/vocabulary-manager.js"></script>
    <script src="js/audio-manager.js"></script>
    <script>
        let currentWord = null;
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let incorrectCount = 0;
        let practiceWords = [];
        const totalQuestions = 10;

        function startPractice() {
            practiceWords = vocabularyManager.getRandomWords(totalQuestions);
            if (practiceWords.length === 0) {
                alert('æ²’æœ‰å¯ç”¨è©å½™ï¼Œè«‹å…ˆåœ¨ç®¡ç†è€…é é¢æ·»åŠ ç”Ÿå­—ï¼');
                return;
            }
            currentQuestionIndex = 0;
            correctCount = 0;
            incorrectCount = 0;
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= practiceWords.length) {
                showResults();
                return;
            }
            
            currentWord = practiceWords[currentQuestionIndex];
            const questionNum = currentQuestionIndex + 1;
            const total = practiceWords.length;
            
            document.getElementById('practiceContent').innerHTML = `
                <div class="question-card">
                    <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 2px;">
                        ç¬¬ ${questionNum} / ${total} é¡Œ
                    </div>
                    <div class="word-display" style="font-size: 2rem;">è«‹è½ç™¼éŸ³</div>
                    <button class="play-btn" id="playBtn" onclick="playAudio()" style="padding: 8px 16px; font-size: 0.85rem; margin: 4px 0;">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
                    <input 
                        type="text" 
                        class="answer-input" 
                        id="answerInput" 
                        placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..."
                        autocomplete="off"
                        style="padding: 10px; font-size: 1rem; max-width: 350px;"
                    >
                    <div class="result-message" id="resultMessage" style="font-size: 0.95rem; padding: 8px 12px; margin: 2px 0;"></div>
                    <div class="correct-answer" id="correctAnswer" style="font-size: 0.85rem; padding: 6px 10px;"></div>
                    <div style="display: flex; gap: 8px; justify-content: center; margin-top: 4px;">
                        <button class="btn btn-primary" id="submitBtn" onclick="checkAnswer()" style="padding: 8px 18px; font-size: 0.9rem;">æäº¤ç­”æ¡ˆ</button>
                        <button class="btn btn-success" id="nextBtn" onclick="nextQuestion()" style="display:none; padding: 8px 18px; font-size: 0.9rem;">ä¸‹ä¸€é¡Œ</button>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const answerInput = document.getElementById('answerInput');
                if (answerInput) {
                    answerInput.focus();
                    // Enter éµæäº¤
                    answerInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' && document.getElementById('submitBtn').style.display !== 'none') {
                            checkAnswer();
                        }
                    });
                }
            }, 100);
        }

        function playAudio() {
            if (currentWord) {
                audioManager.speakEnglish(currentWord.english).catch(console.warn);
            }
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim();
            if (!userAnswer) {
                alert('è«‹è¼¸å…¥ç­”æ¡ˆ');
                return;
            }
            
            const isCorrect = currentWord.english.toLowerCase().trim() === userAnswer.toLowerCase().trim();
            if (isCorrect) {
                correctCount++;
            } else {
                incorrectCount++;
            }
            showResult(isCorrect);
        }

        function showResult(isCorrect) {
            const resultMessage = document.getElementById('resultMessage');
            const correctAnswer = document.getElementById('correctAnswer');
            const submitBtn = document.getElementById('submitBtn');
            const nextBtn = document.getElementById('nextBtn');
            const playBtn = document.getElementById('playBtn');
            const answerInput = document.getElementById('answerInput');
            
            answerInput.disabled = true;
            submitBtn.style.display = 'none';
            nextBtn.style.display = 'inline-flex';
            
            if (isCorrect) {
                resultMessage.className = 'result-message correct';
                resultMessage.textContent = 'âœ… ç­”å°äº†ï¼';
            } else {
                resultMessage.className = 'result-message incorrect';
                resultMessage.textContent = 'âŒ ç­”éŒ¯äº†ï¼';
                correctAnswer.style.display = 'block';
                correctAnswer.textContent = `æ­£ç¢ºç­”æ¡ˆ: ${currentWord.english}`;
            }
            resultMessage.style.display = 'block';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showResults() {
            const accuracy = practiceWords.length > 0 
                ? Math.round((correctCount / practiceWords.length) * 100) 
                : 0;
            
            document.getElementById('practiceContent').innerHTML = `
                <div class="question-card">
                    <div class="header" style="margin-bottom: 8px;">
                        <h1 style="font-size: 1.5rem; margin-bottom: 4px;">ğŸ‰ ç·´ç¿’å®Œæˆï¼</h1>
                        <p style="font-size: 0.85rem;">æ‚¨çš„ç·´ç¿’çµæœå¦‚ä¸‹</p>
                    </div>
                    <div class="stats" style="gap: 8px; margin: 12px 0;">
                        <div class="stat-item" style="padding: 10px 8px;">
                            <h3 style="font-size: 0.8rem; margin-bottom: 4px;">âœ… æ­£ç¢º</h3>
                            <div class="number" style="font-size: 1.5rem;">${correctCount}</div>
                        </div>
                        <div class="stat-item" style="padding: 10px 8px;">
                            <h3 style="font-size: 0.8rem; margin-bottom: 4px;">âŒ éŒ¯èª¤</h3>
                            <div class="number" style="font-size: 1.5rem;">${incorrectCount}</div>
                        </div>
                        <div class="stat-item" style="padding: 10px 8px;">
                            <h3 style="font-size: 0.8rem; margin-bottom: 4px;">ğŸ“Š æº–ç¢ºç‡</h3>
                            <div class="number" style="font-size: 1.5rem;">${accuracy}%</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
                        <button class="btn btn-success" onclick="startPractice()" style="padding: 8px 16px; font-size: 0.9rem;">ğŸ”„ é‡æ–°ç·´ç¿’</button>
                        <button class="btn btn-primary" onclick="window.location.href='index.html'" style="padding: 8px 16px; font-size: 0.9rem;">ğŸ  å›åˆ°é¦–é </button>
                    </div>
                </div>
            `;
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é–‹å§‹ç·´ç¿’
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾… vocabularyManager åˆå§‹åŒ–å®Œæˆ
            setTimeout(() => {
                startPractice();
            }, 100);
        });
    </script>
</body>
</html>
