<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­è‹±ç”Ÿå­—ç¿»è­¯ç³»çµ± - ç®¡ç†è€…å°ˆé </title>
    <link rel="stylesheet" href="styles.css">
</head>
<body style="position:relative;">
    <button class="back-btn" onclick="goBack()" title="å›åˆ°é¦–é ">ğŸ </button>
    
    <div class="container">
        <div class="header">
            <h1>ä¸­è‹±ç”Ÿå­—ç®¡ç†</h1>
            <p class="subtitle">è«‹å…ˆç™»å…¥ç®¡ç†è€…å¸³è™Ÿ</p>
        </div>

        <!-- ç™»å…¥è¡¨å–® -->
        <div class="login-form active" id="loginForm">
            <div class="question-card" style="max-width: 400px; margin: 0 auto;">
                <input 
                    type="password" 
                    id="password" 
                    placeholder="ç®¡ç†è€…å¯†ç¢¼" 
                    class="answer-input"
                    autocomplete="off"
                >
                <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-top: 16px;">ç™»å…¥</button>
            </div>
        </div>

        <!-- ç®¡ç†è€…å°ˆé  -->
        <div class="admin-panel" id="adminPanel">
            <!-- çµ±è¨ˆè³‡è¨Š -->
            <div class="stats stats-centered" style="flex-shrink: 0;">
                <div class="stat-item">
                    <h3>ğŸ“š ç¸½ç”Ÿå­—æ•¸</h3>
                    <div class="number" id="totalWords">0</div>
                </div>
                <div class="stat-item">
                    <h3>ğŸ†• ä»Šæ—¥æ–°å¢</h3>
                    <div class="number" id="todayAdded">0</div>
                </div>
                <div class="stat-item">
                    <h3>ğŸ“Š ç³»çµ±ç‹€æ…‹</h3>
                    <div class="number" id="systemStatus" style="font-size: 1.5rem;">æ­£å¸¸</div>
                </div>
            </div>

            <!-- ä¸»è¦åŠŸèƒ½å€åŸŸ -->
            <div class="admin-main-stack" style="flex: 1; min-height: 0;">
                <!-- æ–°å¢ç”Ÿå­—å€åŸŸ -->
                <div class="add-word-section">
                    <h3>â• æ–°å¢ç”Ÿå­—</h3>
                    
                    <div class="add-single">
                        <input type="text" id="newChinese" placeholder="ä¸­æ–‡" autocomplete="off">
                        <input type="text" id="newEnglish" placeholder="è‹±æ–‡" autocomplete="off">
                        <button class="btn btn-success" onclick="addWord()">æ–°å¢å–®å€‹</button>
                    </div>

                    <div class="add-batch">
                        <h4>ğŸ“ æ‰¹é‡æ–°å¢</h4>
                        <textarea 
                            id="batchInput" 
                            placeholder="è«‹è¼¸å…¥ç”Ÿå­—ï¼Œæ ¼å¼ï¼šä¸­æ–‡,è‹±æ–‡&#10;ä¾‹å¦‚ï¼š&#10;è˜‹æœ,apple&#10;æ›¸,book&#10;æ±½è»Š,car" 
                            rows="5"
                        ></textarea>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="addBatchWords()">æ‰¹é‡æ–°å¢</button>
                            <button class="btn btn-secondary" onclick="clearBatchInput()">æ¸…ç©º</button>
                        </div>
                    </div>
                </div>

                <!-- ç”Ÿå­—åˆ—è¡¨ -->
                <div class="word-list" id="wordList">
                    <h3>ğŸ“‹ ç”Ÿå­—åˆ—è¡¨</h3>
                    <div style="text-align: center; padding: 40px; color: var(--text-light);">
                        è¼‰å…¥ä¸­...
                    </div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="panel-actions panel-actions-bottom" style="flex-shrink: 0;">
                <button class="btn btn-primary" onclick="saveWords()">ğŸ’¾ å„²å­˜è®Šæ›´</button>
                <button class="btn btn-secondary" onclick="logout()">ğŸšª ç™»å‡º</button>
            </div>
        </div>
    </div>

    <script>
        // é è¨­ç”Ÿå­—åº«
        let words = [];
        let wordsData = null;

        // å¾ localStorage è¼‰å…¥ç”Ÿå­—
        function loadWords() {
            const savedWords = localStorage.getItem('vocabulary_words');
            if (savedWords) {
                try {
                    const data = JSON.parse(savedWords);
                    // å…¼å®¹èˆŠæ ¼å¼å’Œæ–°æ ¼å¼
                    if (data.words && Array.isArray(data.words)) {
                        words = data.words;
                        wordsData = data;
                    } else if (Array.isArray(data)) {
                        words = data;
                        wordsData = { words: data };
                    }
                } catch (e) {
                    console.error('è¼‰å…¥å¤±æ•—:', e);
                    loadDefaultWords();
                }
            } else {
                loadDefaultWords();
            }
            updateStats();
        }

        function loadDefaultWords() {
            words = [
                { chinese: 'è˜‹æœ', english: 'apple' },
                { chinese: 'æ›¸', english: 'book' },
                { chinese: 'æ±½è»Š', english: 'car' },
                { chinese: 'ç‹—', english: 'dog' },
                { chinese: 'æˆ¿å­', english: 'house' },
                { chinese: 'è²“', english: 'cat' },
                { chinese: 'é³¥', english: 'bird' },
                { chinese: 'èŠ±', english: 'flower' },
                { chinese: 'æ¨¹', english: 'tree' },
                { chinese: 'æ°´', english: 'water' }
            ];
            wordsData = { words: words };
        }

        // å„²å­˜ç”Ÿå­—åˆ° localStorage
        function saveWords() {
            try {
                // ä½¿ç”¨ vocabularyManager çš„æ ¼å¼
                const data = {
                    words: words,
                    categories: extractCategories(),
                    difficulties: ['easy', 'medium', 'hard'],
                    lastUpdated: new Date().toISOString().split('T')[0],
                    version: '1.0'
                };
                localStorage.setItem('vocabulary_words', JSON.stringify(data));
                wordsData = data;
                alert('âœ… ç”Ÿå­—å·²å„²å­˜ï¼');
                updateStats();
                renderWordList();
            } catch (e) {
                alert('âŒ å„²å­˜å¤±æ•—ï¼š' + e.message);
            }
        }

        function extractCategories() {
            const categories = new Set();
            words.forEach(word => {
                if (word.category) categories.add(word.category);
            });
            return Array.from(categories);
        }

        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStats() {
            const totalWordsEl = document.getElementById('totalWords');
            if (totalWordsEl) {
                totalWordsEl.textContent = words.length;
            }
            const todayAddedEl = document.getElementById('todayAdded');
            if (todayAddedEl) {
                todayAddedEl.textContent = '0';
            }
            const systemStatusEl = document.getElementById('systemStatus');
            if (systemStatusEl) {
                systemStatusEl.textContent = 'æ­£å¸¸';
            }
        }

        // ç®¡ç†è€…ç™»å…¥
        function login() {
            const password = document.getElementById('password').value;
            if (password === 'admin@123') {
                // è¨­ç½®ç™»å…¥ç‹€æ…‹
                sessionStorage.setItem('admin_logged_in', 'true');
                sessionStorage.setItem('admin_login_time', Date.now().toString());
                
                document.getElementById('loginForm').classList.remove('active');
                document.getElementById('adminPanel').classList.add('active');
                loadWords();
                renderWordList();
                updateStats();
            } else {
                alert('âŒ å¯†ç¢¼éŒ¯èª¤ï¼');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        // ç™»å‡º
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                // æ¸…é™¤ç™»å…¥ç‹€æ…‹
                sessionStorage.removeItem('admin_logged_in');
                sessionStorage.removeItem('admin_login_time');
                
                document.getElementById('loginForm').classList.add('active');
                document.getElementById('adminPanel').classList.remove('active');
                document.getElementById('password').value = '';
            }
        }

        // æ¸²æŸ“ç”Ÿå­—åˆ—è¡¨
        function renderWordList() {
            const wordListEl = document.getElementById('wordList');
            if (!wordListEl) return;

            if (words.length === 0) {
                wordListEl.innerHTML = `
                    <h3>ğŸ“‹ ç”Ÿå­—åˆ—è¡¨</h3>
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                        <p style="font-size: 1.1rem; margin-bottom: 16px;">é‚„æ²’æœ‰ç”Ÿå­—</p>
                        <p>è«‹åœ¨ä¸Šæ–¹æ–°å¢ç”Ÿå­—</p>
                    </div>
                `;
                return;
            }

            const fragment = document.createDocumentFragment();
            const title = document.createElement('h3');
            title.textContent = 'ğŸ“‹ ç”Ÿå­—åˆ—è¡¨';
            fragment.appendChild(title);

            words.forEach((word, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                
                const wordInfo = document.createElement('div');
                wordInfo.className = 'word-info';
                wordInfo.innerHTML = `
                    <div class="chinese">${escapeHtml(word.chinese)}</div>
                    <div class="english">${escapeHtml(word.english)}</div>
                `;
                
                const wordActions = document.createElement('div');
                wordActions.className = 'word-actions';
                wordActions.innerHTML = `
                    <button class="edit-btn" onclick="editWord(${index})">ç·¨è¼¯</button>
                    <button class="delete-btn" onclick="deleteWord(${index})">åˆªé™¤</button>
                `;
                
                wordItem.appendChild(wordInfo);
                wordItem.appendChild(wordActions);
                fragment.appendChild(wordItem);
            });

            wordListEl.innerHTML = '';
            wordListEl.appendChild(fragment);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ–°å¢ç”Ÿå­—
        function addWord() {
            const chinese = document.getElementById('newChinese').value.trim();
            const english = document.getElementById('newEnglish').value.trim();
            
            if (!chinese || !english) {
                alert('âš ï¸ è«‹å¡«å¯«å®Œæ•´çš„ä¸­æ–‡å’Œè‹±æ–‡ï¼');
                return;
            }

            // æª¢æŸ¥æ˜¯å¦é‡è¤‡
            const exists = words.some(w => 
                w.chinese === chinese && w.english.toLowerCase() === english.toLowerCase()
            );
            
            if (exists) {
                alert('âš ï¸ é€™å€‹ç”Ÿå­—å·²ç¶“å­˜åœ¨ï¼');
                return;
            }

            words.push({ chinese, english });
            document.getElementById('newChinese').value = '';
            document.getElementById('newEnglish').value = '';
            updateStats();
            renderWordList();
            
            // è‡ªå‹•å„²å­˜
            saveWords();
        }

        // æ‰¹é‡æ–°å¢ç”Ÿå­—
        function addBatchWords() {
            const batchInput = document.getElementById('batchInput').value.trim();
            if (!batchInput) {
                alert('âš ï¸ è«‹è¼¸å…¥è¦æ–°å¢çš„ç”Ÿå­—ï¼');
                return;
            }

            const lines = batchInput.split('\n').filter(line => line.trim());
            let addedCount = 0;
            let errorCount = 0;
            const errors = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const parts = line.split(',').map(part => part.trim());
                if (parts.length >= 2 && parts[0] && parts[1]) {
                    const chinese = parts[0];
                    const english = parts[1];
                    
                    // æª¢æŸ¥æ˜¯å¦é‡è¤‡
                    const exists = words.some(w => 
                        w.chinese === chinese && w.english.toLowerCase() === english.toLowerCase()
                    );
                    
                    if (!exists) {
                        words.push({ chinese, english });
                        addedCount++;
                    } else {
                        errors.push(`ç¬¬ ${i + 1} è¡Œï¼šå·²å­˜åœ¨`);
                    }
                } else {
                    errors.push(`ç¬¬ ${i + 1} è¡Œï¼šæ ¼å¼éŒ¯èª¤`);
                    errorCount++;
                }
            }

            if (addedCount > 0 || errorCount > 0) {
                let message = `æˆåŠŸæ–°å¢ ${addedCount} å€‹ç”Ÿå­—`;
                if (errors.length > 0) {
                    message += `\n${errors.length} å€‹é …ç›®æœ‰å•é¡Œ`;
                }
                alert(message);
                document.getElementById('batchInput').value = '';
                updateStats();
                renderWordList();
                saveWords();
            } else {
                alert('âš ï¸ æ²’æœ‰æˆåŠŸæ–°å¢ä»»ä½•ç”Ÿå­—ï¼Œè«‹æª¢æŸ¥æ ¼å¼ï¼');
            }
        }

        // æ¸…ç©ºæ‰¹é‡è¼¸å…¥
        function clearBatchInput() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºè¼¸å…¥å…§å®¹å—ï¼Ÿ')) {
                document.getElementById('batchInput').value = '';
            }
        }

        // ç·¨è¼¯ç”Ÿå­—
        function editWord(index) {
            if (index < 0 || index >= words.length) return;
            
            const word = words[index];
            const newChinese = prompt('è«‹è¼¸å…¥æ–°çš„ä¸­æ–‡ï¼š', word.chinese);
            if (newChinese === null) return;
            
            const newEnglish = prompt('è«‹è¼¸å…¥æ–°çš„è‹±æ–‡ï¼š', word.english);
            if (newEnglish === null) return;

            if (newChinese.trim() && newEnglish.trim()) {
                words[index] = { 
                    chinese: newChinese.trim(), 
                    english: newEnglish.trim() 
                };
                renderWordList();
                saveWords();
            }
        }

        // åˆªé™¤ç”Ÿå­—
        function deleteWord(index) {
            if (index < 0 || index >= words.length) return;
            
            const word = words[index];
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${word.chinese} / ${word.english}ã€å—ï¼Ÿ`)) {
                words.splice(index, 1);
                updateStats();
                renderWordList();
                saveWords();
            }
        }

        // å›åˆ°é¦–é 
        function goBack() {
            if (confirm('ç¢ºå®šè¦å›åˆ°é¦–é å—ï¼Ÿæœªå„²å­˜çš„è®Šæ›´å°‡æœƒéºå¤±ã€‚')) {
                window.location.href = 'index.html';
            }
        }

        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        function checkLoginStatus() {
            const isLoggedIn = sessionStorage.getItem('admin_logged_in');
            const loginTime = sessionStorage.getItem('admin_login_time');
            
            // æª¢æŸ¥ç™»å…¥ç‹€æ…‹å’Œæ™‚é–“ï¼ˆ30åˆ†é˜å…§æœ‰æ•ˆï¼‰
            if (isLoggedIn === 'true' && loginTime) {
                const timeDiff = Date.now() - parseInt(loginTime);
                const thirtyMinutes = 30 * 60 * 1000; // 30åˆ†é˜çš„æ¯«ç§’æ•¸
                
                if (timeDiff < thirtyMinutes) {
                    // è‡ªå‹•ç™»å…¥
                    document.getElementById('loginForm').classList.remove('active');
                    document.getElementById('adminPanel').classList.add('active');
                    loadWords();
                    renderWordList();
                    updateStats();
                    return true;
                } else {
                    // ç™»å…¥éæœŸï¼Œæ¸…é™¤ç‹€æ…‹
                    sessionStorage.removeItem('admin_logged_in');
                    sessionStorage.removeItem('admin_login_time');
                }
            }
            return false;
        }

        // éµç›¤äº‹ä»¶è™•ç†
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const loginForm = document.getElementById('loginForm');
                if (loginForm && loginForm.classList.contains('active')) {
                    login();
                }
            }
            if (e.key === 'Escape') {
                const loginForm = document.getElementById('loginForm');
                if (!loginForm.classList.contains('active')) {
                    logout();
                }
            }
        });

        // åˆå§‹åŒ–ï¼šæª¢æŸ¥ç™»å…¥ç‹€æ…‹
        if (!checkLoginStatus()) {
            // å¦‚æœæ²’æœ‰ç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥è¡¨å–®
            loadWords(); // ä»ç„¶éœ€è¦è¼‰å…¥æ•¸æ“šç”¨æ–¼é¡¯ç¤ºçµ±è¨ˆ
        }
    </script>
</body>
</html>
